<style>
    .pdv-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    .pdv-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .pdv-header h1 {
        margin: 0 0 0.5rem 0;
        font-size: 28px;
        font-weight: 700;
    }

    .pdv-header p {
        margin: 0;
        font-size: 16px;
        opacity: 0.9;
    }

    .pdv-search-bar {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .search-input-wrapper {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .search-input {
        flex: 1;
        padding: 0.8rem 1.2rem;
        border: 2px solid #E5E7EB;
        border-radius: 8px;
        font-size: 15px;
        font-family: 'Noto Sans KR', sans-serif;
        transition: border-color 0.2s;
    }

    .search-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .search-button {
        padding: 0.8rem 2rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }

    .search-button:hover {
        background: #5568d3;
    }

    .pdv-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .stat-number {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 14px;
        color: #6B7280;
    }

    .conversation-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
    }

    .conversation-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
    }

    .conversation-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .card-category {
        background: #667eea;
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }

    .card-date {
        font-size: 13px;
        color: #6B7280;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        color: #1F2937;
        margin-bottom: 0.8rem;
    }

    .card-summary {
        font-size: 14px;
        color: #4B5563;
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .card-5w1h {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        font-size: 13px;
    }

    .w-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #6B7280;
    }

    .w-label {
        font-weight: 600;
        color: #667eea;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6B7280;
    }

    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state-text {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .empty-state-subtext {
        font-size: 14px;
        opacity: 0.8;
    }

    /* ëŒ€í™” ìƒì„¸ ëª¨ë‹¬ */
    .conversation-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .conversation-modal.active {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideUp 0.3s ease;
    }

    @keyframes modalSlideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .modal-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #E5E7EB;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        color: #1F2937;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 32px;
        color: #6B7280;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
        line-height: 1;
    }

    .modal-close:hover {
        background: #F3F4F6;
        color: #1F2937;
    }

    .modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
    }

    .modal-metadata {
        background: #F9FAFB;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .metadata-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    .metadata-item {
        display: flex;
        gap: 0.5rem;
    }

    .metadata-label {
        font-weight: 700;
        color: #667eea;
        min-width: 80px;
    }

    .metadata-value {
        color: #4B5563;
    }

    .modal-messages {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .modal-message {
        display: flex;
        gap: 1rem;
        max-width: 85%;
    }

    .modal-message.user {
        align-self: flex-end;
        flex-direction: row-reverse;
    }

    .modal-message.assistant {
        align-self: flex-start;
    }

    .message-role {
        font-size: 12px;
        font-weight: 700;
        color: #667eea;
        text-transform: uppercase;
        min-width: 80px;
        padding-top: 0.3rem;
    }

    .modal-message.user .message-role {
        color: #2196F3;
        text-align: right;
    }

    .message-content {
        background: #F3F4F6;
        padding: 1rem 1.2rem;
        border-radius: 12px;
        font-size: 15px;
        line-height: 1.6;
        color: #1F2937;
        flex: 1;
    }

    .modal-message.user .message-content {
        background: #2196F3;
        color: white;
    }

</style>

<div class="pdv-container">
    <!-- í—¤ë” -->
    <div class="pdv-header">
        <h1>ğŸ“š Personal Data Vault (PDV)</h1>
        <p>ë‚˜ì˜ ëª¨ë“  AI ìƒë‹´ ê¸°ë¡ì„ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê³  ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>

    <!-- ê²€ìƒ‰ ë°” -->
    <div class="pdv-search-bar">
        <div class="search-input-wrapper">
            <input 
                type="text" 
                class="search-input" 
                id="pdvSearchInput" 
                placeholder="ëŒ€í™” ë‚´ìš©, ì¹´í…Œê³ ë¦¬, ë‚ ì§œë¡œ ê²€ìƒ‰í•˜ì„¸ìš”..."
                onkeypress="if(event.key==='Enter') searchConversations()"
            >
            <button class="search-button" onclick="searchConversations()">ğŸ” ê²€ìƒ‰</button>
        </div>
    </div>

    <!-- í†µê³„ -->
    <div class="pdv-stats">
        <div class="stat-card">
            <div class="stat-number" id="totalConversations">0</div>
            <div class="stat-label">ì´ ëŒ€í™”</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="thisWeekConversations">0</div>
            <div class="stat-label">ì´ë²ˆ ì£¼</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="thisMonthConversations">0</div>
            <div class="stat-label">ì´ë²ˆ ë‹¬</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalMessages">0</div>
            <div class="stat-label">ì´ ë©”ì‹œì§€</div>
        </div>
    </div>

    <!-- ëŒ€í™” ëª©ë¡ -->
    <div class="conversation-list" id="conversationList">
        <!-- ëŒ€í™” ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>

    <!-- ë¹ˆ ìƒíƒœ -->
    <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-state-icon">ğŸ’¬</div>
        <div class="empty-state-text">ì•„ì§ ì €ì¥ëœ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="empty-state-subtext">AI ìƒë‹´ì„ ì‹œì‘í•˜ë©´ ëŒ€í™” ë‚´ìš©ì´ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤</div>
    </div>

<!-- ëŒ€í™” ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
<div class="conversation-modal" id="conversationModal" onclick="closeConversationModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2 id="modalTitle">ëŒ€í™” ìƒì„¸</h2>
            <button class="modal-close" onclick="closeConversationModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="modal-metadata" id="modalMetadata"></div>
            <div class="modal-messages" id="modalMessages"></div>
        </div>
    </div>
</div>

</div>

<script>
(function() {
    // PDV ë°ì´í„° ì €ì¥ì†Œ (localStorage ì‚¬ìš©)
    const PDV_STORAGE_KEY = 'jeju_integrated_pdv';

    // PDV ë°ì´í„° êµ¬ì¡°
    // {
    //   id: timestamp,
    //   category: 'ì¹´í…Œê³ ë¦¬',
    //   service: 'ì„œë¹„ìŠ¤ëª…',
    //   timestamp: 'ISO datetime',
    //   who: 'ì‚¬ìš©ì',
    //   what: 'ì£¼ì œ',
    //   when: 'ë‚ ì§œ/ì‹œê°„',
    //   where: 'ìœ„ì¹˜/íƒ­',
    //   why: 'ëª©ì ',
    //   how: 'ë°©ë²•/ê²°ê³¼',
    //   messages: [{role, content}, ...],
    //   summary: 'ìš”ì•½'
    // }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    function initPDV() {
        loadConversations();
        updateStats();
    }

    // ëŒ€í™” ëª©ë¡ ë¡œë“œ
    function loadConversations() {
        const conversations = getStoredConversations();
        const listContainer = document.getElementById('conversationList');
        const emptyState = document.getElementById('emptyState');

        if (conversations.length === 0) {
            listContainer.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }

        emptyState.style.display = 'none';
        listContainer.innerHTML = '';

        // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
        conversations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        conversations.forEach(conv => {
            const card = createConversationCard(conv);
            listContainer.appendChild(card);
        });
    }

    // ëŒ€í™” ì¹´ë“œ ìƒì„±
    function createConversationCard(conv) {
        const card = document.createElement('div');
        card.className = 'conversation-card';
        card.onclick = () => showConversationDetail(conv.id);

        const date = new Date(conv.timestamp);
        const dateStr = date.toLocaleDateString('ko-KR', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        card.innerHTML = `
            <div class="card-header">
                <span class="card-category">${conv.category || 'ì¼ë°˜'}</span>
                <span class="card-date">${dateStr}</span>
            </div>
            <div class="card-title">${conv.what || 'ì œëª© ì—†ìŒ'}</div>
            <div class="card-summary">${conv.summary || 'ìš”ì•½ ì—†ìŒ'}</div>
            <div class="card-5w1h">
                <div class="w-item">
                    <span class="w-label">Who:</span>
                    <span>${conv.who || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">When:</span>
                    <span>${conv.when || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">Where:</span>
                    <span>${conv.where || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">Why:</span>
                    <span>${conv.why || '-'}</span>
                </div>
            </div>
        `;

        return card;
    }

    // localStorageì—ì„œ ëŒ€í™” ê°€ì ¸ì˜¤ê¸°
    function getStoredConversations() {
        const stored = localStorage.getItem(PDV_STORAGE_KEY);
        return stored ? JSON.parse(stored) : [];
    }

    // localStorageì— ëŒ€í™” ì €ì¥
    function saveConversation(conversation) {
        const conversations = getStoredConversations();
        conversations.push(conversation);
        localStorage.setItem(PDV_STORAGE_KEY, JSON.stringify(conversations));
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
        const conversations = getStoredConversations();
        const now = new Date();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

        const thisWeek = conversations.filter(c => new Date(c.timestamp) > weekAgo).length;
        const thisMonth = conversations.filter(c => new Date(c.timestamp) > monthStart).length;
        const totalMessages = conversations.reduce((sum, c) => sum + (c.messages?.length || 0), 0);

        document.getElementById('totalConversations').textContent = conversations.length;
        document.getElementById('thisWeekConversations').textContent = thisWeek;
        document.getElementById('thisMonthConversations').textContent = thisMonth;
        document.getElementById('totalMessages').textContent = totalMessages;
    }

    // ëŒ€í™” ìƒì„¸ ë³´ê¸° (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„)
    

    // ê²€ìƒ‰ (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„)
    window.searchConversations = function() {
        const query = document.getElementById('pdvSearchInput').value;
        alert('ê²€ìƒ‰ ê¸°ëŠ¥ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤. ê²€ìƒ‰ì–´: ' + query);
    };

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ë‹¤ë¥¸ íƒ­ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
    window.saveToPDV = function(conversationData) {
        saveConversation(conversationData);
        console.log('PDVì— ëŒ€í™” ì €ì¥ë¨:', conversationData);
    };

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    setTimeout(initPDV, 100);

    // í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
    window.addSamplePDVData = function() {
        const sample = {
            id: Date.now(),
            category: 'ì˜ë£Œ',
            service: 'ì§„ë£Œ ì˜ˆì•½',
            timestamp: new Date().toISOString(),
            who: 'ì‚¬ìš©ì',
            what: 'ì •í˜•ì™¸ê³¼ ì§„ë£Œ ì˜ˆì•½ ë¬¸ì˜',
            when: new Date().toLocaleString('ko-KR'),
            where: 'ì˜ë£Œ íƒ­',
            why: 'ë¬´ë¦ í†µì¦ ì§„ë£Œ',
            how: 'AI ìƒë‹´ì„ í†µí•´ ì˜ˆì•½ ë°©ë²• ì•ˆë‚´ë°›ìŒ',
            messages: [
                { role: 'user', content: 'ì •í˜•ì™¸ê³¼ ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”' },
                { role: 'assistant', content: 'ì •í˜•ì™¸ê³¼ ì˜ˆì•½ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤...' }
            ],
            summary: 'ì •í˜•ì™¸ê³¼ ì˜ˆì•½ ë°©ë²•ì— ëŒ€í•´ ìƒë‹´í•˜ê³  ì˜¨ë¼ì¸ ì˜ˆì•½ ë§í¬ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.'
        };
        saveToPDV(sample);
        loadConversations();
        updateStats();
        alert('ìƒ˜í”Œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
    };
    // ëŒ€í™” ìƒì„¸ ë³´ê¸°
    function showConversationDetail(id) {
        const conversations = getStoredConversations();
        const conv = conversations.find(c => c.id === id);
        
        if (!conv) {
            alert('ëŒ€í™”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        const modal = document.getElementById('conversationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMetadata = document.getElementById('modalMetadata');
        const modalMessages = document.getElementById('modalMessages');
        
        if (!modal) return;
        
        // ì œëª© ì„¤ì •
        modalTitle.textContent = conv.what || 'ëŒ€í™” ìƒì„¸';
        
        // ë©”íƒ€ë°ì´í„° ì„¤ì •
        modalMetadata.innerHTML = `
            <div class="metadata-grid">
                <div class="metadata-item">
                    <span class="metadata-label">Who:</span>
                    <span class="metadata-value">${conv.who || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">When:</span>
                    <span class="metadata-value">${conv.when || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Where:</span>
                    <span class="metadata-value">${conv.where || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Why:</span>
                    <span class="metadata-value">${conv.why || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">How:</span>
                    <span class="metadata-value">${conv.how || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Category:</span>
                    <span class="metadata-value">${conv.category || '-'}</span>
                </div>
            </div>
        `;
        
        // ë©”ì‹œì§€ ì„¤ì •
        if (conv.messages && conv.messages.length > 0) {
            modalMessages.innerHTML = conv.messages.map(msg => {
                const roleText = msg.role === 'user' ? 'You' : 'AI';
                return `
                    <div class="modal-message ${msg.role}">
                        <div class="message-role">${roleText}</div>
                        <div class="message-content">${escapeHtml(msg.content)}</div>
                    </div>
                `;
            }).join('');
        } else {
            modalMessages.innerHTML = '<p style="text-align: center; color: #6B7280;">ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
        
        // ëª¨ë‹¬ í‘œì‹œ
        modal.classList.add('active');
    }
    
    // ëª¨ë‹¬ ë‹«ê¸°
    window.closeConversationModal = function(event) {
        const modal = document.getElementById('conversationModal');
        if (modal) {
            modal.classList.remove('active');
        }
    };
    
    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

})();
</script>
