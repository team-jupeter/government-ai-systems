<style>
    .pdv-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    .pdv-header {
        background: white;
        
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        border: 2px solid #9CA3AF; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .pdv-header h1 {
        color: #1F2937;
        margin: 0 0 0.5rem 0;
        font-size: 28px;
        font-weight: 700;
    }

    .pdv-header p {
        color: #6B7280;
        margin: 0;
        font-size: 16px;
        
    }

    .pdv-search-bar {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .search-input-wrapper {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .search-input {
        flex: 1;
        padding: 0.8rem 1.2rem;
        border: 2px solid #E5E7EB;
        border-radius: 8px;
        font-size: 15px;
        font-family: 'Noto Sans KR', sans-serif;
        transition: border-color 0.2s;
    }

    .search-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .search-button {
        padding: 0.8rem 2rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }

    .search-button:hover {
        background: #5568d3;
    }

    .pdv-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .stat-number {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 14px;
        color: #6B7280;
    }

    .conversation-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
    }

    .conversation-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
    }

    .conversation-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .card-category {
        background: #667eea;
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }

    .card-date {
        font-size: 13px;
        color: #6B7280;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        color: #1F2937;
        margin-bottom: 0.8rem;
    }

    .card-summary {
        font-size: 14px;
        color: #4B5563;
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .card-5w1h {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        font-size: 13px;
    }

    .w-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #6B7280;
    }

    .w-label {
        font-weight: 600;
        color: #667eea;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6B7280;
    }

    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state-text {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .empty-state-subtext {
        font-size: 14px;
        opacity: 0.8;
    }

    /* 대화 상세 모달 */
    .conversation-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .conversation-modal.active {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideUp 0.3s ease;
    }

    @keyframes modalSlideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .modal-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #E5E7EB;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        color: #1F2937;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 32px;
        color: #6B7280;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
        line-height: 1;
    }

    .modal-close:hover {
        background: #F3F4F6;
        color: #1F2937;
    }

    .modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
    }

    .modal-metadata {
        background: #F9FAFB;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .metadata-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    .metadata-item {
        display: flex;
        gap: 0.5rem;
    }

    .metadata-label {
        font-weight: 700;
        color: #667eea;
        min-width: 80px;
    }

    .metadata-value {
        color: #4B5563;
    }

    .modal-messages {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .modal-message {
        display: flex;
        gap: 1rem;
        max-width: 85%;
    }

    .modal-message.user {
        align-self: flex-end;
        flex-direction: row-reverse;
    }

    .modal-message.assistant {
        align-self: flex-start;
    }

    .message-role {
        font-size: 12px;
        font-weight: 700;
        color: #667eea;
        text-transform: uppercase;
        min-width: 80px;
        padding-top: 0.3rem;
    }

    .modal-message.user .message-role {
        color: #2196F3;
        text-align: right;
    }

    .message-content {
        background: #F3F4F6;
        padding: 1rem 1.2rem;
        border-radius: 12px;
        font-size: 15px;
        line-height: 1.6;
        color: #1F2937;
        flex: 1;
    }

    .modal-message.user .message-content {
        background: #2196F3;
        color: white;
    }


    }

    /* 아코디언 컨테이너를 그리드로 */

    /* PDV 아코디언 그리드 - 6열 강제 */
    .accordion-grid {
        display: grid !important;
        grid-template-columns: repeat(6, 1fr) !important;
        gap: 0.5rem !important;
        margin: 1.5rem 0 !important;
        width: 100% !important;
    }
    
    @media (max-width: 1800px) {
        .accordion-grid {
            grid-template-columns: repeat(6, 1fr) !important;
        }
    }
    
    @media (max-width: 1400px) {
        .accordion-grid {
            grid-template-columns: repeat(3, 1fr) !important;
        }
    }
    
    @media (max-width: 1024px) {
        .accordion-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    
    @media (max-width: 768px) {
        .accordion-grid {
            grid-template-columns: 1fr !important;
        }
    }
    
    .accordion-card {
        background: white !important;
        border: 2px solid #E5E7EB !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        transition: all 0.3s ease !important;
        height: fit-content !important;
        min-width: 0 !important;
    }
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        transform: translateY(-2px);
    }
    
    .accordion-card-header {
        padding: 0.75rem 0.875rem;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        background: #F9FAFB;
        transition: background 0.2s ease;
        user-select: none;
        min-height: 70px;
    }
    
    .accordion-card-header:hover {
        background: #F3F4F6;
    }
    
    .accordion-card-header.active {
        background: #EFF6FF;
    }
    
    .accordion-icon-title {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .accordion-icon-title span:first-child {
        font-size: 20px;
    }
    
    .accordion-icon-title span:last-child {
        font-size: 0.875rem;
        font-weight: 600;
        color: #1F2937;
        line-height: 1.3;
    }
    
    .accordion-arrow {
        color: #6B7280;
        font-size: 14px;
        align-self: flex-end;
        transition: transform 0.3s ease;
    }
    
    .accordion-card-header.active .accordion-arrow {
        transform: rotate(180deg);
        color: #3B82F6;
    }
    
    .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .accordion-content.active {
        max-height: 2000px;
        transition: max-height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .accordion-content > div {
        padding: 1.25rem;
        background: white;
    }

    /* PDV 전용 Floating 버튼 */
    .floating-pdv-btn {
        position: fixed;
        top: 180px;
        right: 30px;
        z-index: 999;
        background: white; border: 2px solid #9CA3AF;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 13px;
        text-decoration: none;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        border: none;
    }
    
    .floating-pdv-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        background: linear-gradient(135deg, #5568d3 0%, #6a3d8f 100%);
    }
    
    .floating-pdv-btn span:first-child {
        font-size: 16px;
    }

    /* Floating PDV 버튼 */
    .floating-pdv-btn {
        position: fixed;
        top: 180px;
        right: 30px;
        z-index: 999;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 13px;
        text-decoration: none;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        border: none;
    }
    
    .floating-pdv-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
    }
</style>

<!-- Floating PDV 버튼 -->
<a href="http://100.30.14.224/private-data-vault/" target="_blank" class="floating-pdv-btn">
    <span>🔐</span>
    <span>PDV 공식 사이트</span>
</a>

<div class="pdv-container">
<a href="http://100.30.14.224/private-data-vault/" target="_blank" class="floating-pdv-btn">
<span>🔐</span>
<span>PDV 공식 사이트</span>
</a>
    <!-- 헤더 -->
    <div class="pdv-header">
        <h1>📚 Personal Data Vault (PDV)</h1>
        <p>나의 모든 AI 상담 기록을 안전하게 보관하고 검색할 수 있습니다</p>
    </div>

    <!-- PDV 핵심 기능 (6개 카드) -->
    <div style="margin: 1.5rem 0 2rem 0;">
        <h2 style="font-size: 1.25rem; font-weight: 700; color: #1F2937; margin-bottom: 1rem;">🔐 PDV 핵심 기능</h2>
        
        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.75rem;">
            <!-- 카드 1 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">🔐</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">3단계 본인 인증</div>
            </div>
            
            <!-- 카드 2 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">🛡️</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">3단계 암호화</div>
            </div>
            
            <!-- 카드 3 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">🔗</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">데이터 무결성</div>
            </div>
            
            <!-- 카드 4 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">✅</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">교차 검증</div>
            </div>
            
            <!-- 카드 5 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">📜</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">법적 증명</div>
            </div>
            
            <!-- 카드 6 -->
            <div style="background: white; border: 2px solid #E5E7EB; border-radius: 8px; padding: 1.25rem; text-align: center; transition: all 0.3s ease; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center;" onmouseover="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                <div style="font-size: 32px; margin-bottom: 0.5rem;">🔑</div>
                <div style="font-size: 0.875rem; font-weight: 600; color: #1F2937; line-height: 1.3;">접근 권한</div>
            </div>
        </div>
    </div>
        <h2 class="pdv-features-title">🔐 PDV 핵심 기능</h2>
        <div class="accordion-grid">
        
        <!-- 1. 3단계 본인 인증 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>🔐</span>
                    <span>3단계 본인 인증 시스템</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>1단계: 생체정보 + 개인비밀번호</h4>
                    <ul>
                        <li><strong>얼굴 인식:</strong> 99.7% 정확도로 본인 확인</li>
                        <li><strong>지문 인식:</strong> 99.8% 정확도로 지문 매칭</li>
                        <li><strong>음성 인식:</strong> 99.5% 정확도 (선택 사항)</li>
                        <li><strong>PIN 비밀번호:</strong> 본인만 아는 숫자 비밀번호</li>
                    </ul>
                    <p>종합 점수 95% 이상 + 비밀번호 일치 시 1단계 통과</p>
                    
                    <h4>2단계: AI 개인화 질문 + 실시간 인증번호</h4>
                    <ul>
                        <li>AI가 개인의 실제 활동 기록을 바탕으로 질문 생성</li>
                        <li>예: "작년에 가장 많이 구매한 상품은?", "최근 3개월 방문 지역은?"</li>
                        <li>30초마다 변경되는 동적 인증번호 (시간 + 위치 + 기기 정보 조합)</li>
                    </ul>
                    
                    <h4>3단계: 오픈해시 기반 분산 검증</h4>
                    <ul>
                        <li>여러 검증 서버에서 동시에 신원 확인</li>
                        <li>과반수 이상 승인 시에만 접근 허용</li>
                        <li>모든 검증 과정이 오픈해시 체인에 투명하게 기록</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 2. 3단계 암호화 보안 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>🛡️</span>
                    <span>3단계 암호화 보안 시스템</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>최고 수준의 암호화</h4>
                    <ol>
                        <li><strong>1단계:</strong> 256비트 랜덤 암호화 키 생성</li>
                        <li><strong>2단계:</strong> AES-256 방식으로 데이터 완전 암호화</li>
                        <li><strong>3단계:</strong> RSA-4096으로 암호키 자체를 다시 암호화</li>
                    </ol>
                    <p><strong>결과:</strong> 본인의 개인키 없이는 절대 해독 불가능</p>
                    
                    <h4>동형암호 기술</h4>
                    <ul>
                        <li>개인정보를 해독하지 않고도 AI가 분석 가능</li>
                        <li>예: 주민번호를 보지 않고도 "19세 이상" 확인</li>
                        <li>통계 분석 시 개인정보 완전 보호</li>
                    </ul>
                    
                    <h4>영지식 증명</h4>
                    <ul>
                        <li>비밀을 공개하지 않고 조건 충족 여부만 증명</li>
                        <li>필요한 정보만 확인하고 불필요한 정보는 완전 보호</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 3. 오픈해시 기반 무결성 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>🔗</span>
                    <span>오픈해시 기반 데이터 무결성</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>해시 전용 저장 (Hash-Only Storage)</h4>
                    <ul>
                        <li><strong>원본 데이터:</strong> 오직 사용자 단말기에만 저장</li>
                        <li><strong>클라우드:</strong> SHA-256 해시값(32 bytes)만 저장</li>
                        <li><strong>효과:</strong> 제3자가 원본 데이터 접근 불가</li>
                    </ul>
                    
                    <h4>4계층 분산 시스템</h4>
                    <ol>
                        <li><strong>Layer 1 (70%):</strong> Edge Device - 스마트폰, IoT 기기</li>
                        <li><strong>Layer 2 (20%):</strong> Edge Server - 지역 서버</li>
                        <li><strong>Layer 3 (9%):</strong> Core Engine - 중앙 엔진</li>
                        <li><strong>Layer 4 (1%):</strong> Cloud Archive - 영구 보관</li>
                    </ol>
                    
                    <h4>AWS 실증 실험 성능</h4>
                    <ul>
                        <li><strong>처리 속도:</strong> 25,907 records/sec (블록체인 대비 1,727~3,701배)</li>
                        <li><strong>에너지 효율:</strong> 99% 절감</li>
                        <li><strong>저장 공간:</strong> 레코드당 32 bytes</li>
                        <li><strong>정확도:</strong> 98.9% 계층 선택 정확도</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 4. 교차 검증 시스템 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>✅</span>
                    <span>자동 교차 검증 시스템</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>거래 당사자 간 자동 검증</h4>
                    <p>거래 발생 시 양측의 PDV에 동일한 거래가 기록되고, 해시값이 오픈해시 시스템에 저장되어 자동으로 일치 여부를 확인합니다.</p>
                    
                    <h4>작동 방식</h4>
                    <ol>
                        <li>개인 A와 법인 B가 거래 (예: 100만원)</li>
                        <li>각자 PDV에 거래 내용 기록</li>
                        <li>해시값 H_A, H_B 생성 및 오픈해시에 저장</li>
                        <li>시스템이 자동으로 H_A와 H_B 비교</li>
                        <li>일치 → "검증 완료" / 불일치 → 즉시 경고</li>
                    </ol>
                    
                    <h4>AWS 실증 결과</h4>
                    <ul>
                        <li>개인 A: 1,000,000원 기록 → H_A: 1f94c4e14f21f14d...</li>
                        <li>법인 B: 500,000원 허위 기록 → H_B: b3c4fec6c2a620c2...</li>
                        <li><strong>결과:</strong> 해시 불일치 즉시 탐지, 양측에 경고 발송</li>
                    </ul>
                    
                    <h4>관련 당국 자동 통보</h4>
                    <ul>
                        <li>세금 관련 거래 → 국세청 (해시값 + 거래 유형 + 금액 범위)</li>
                        <li>의료 거래 → 보건복지부</li>
                        <li>금융 거래 → 금융감독원</li>
                        <li><strong>원본 데이터는 전송하지 않음</strong></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 5. 법적 증명력 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>📜</span>
                    <span>법적 증명력 확보</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>활동 증명 (Activity Proof)</h4>
                    <p>과거 특정 시점에 특정 행위를 했다는 사실을 오픈해시 체인으로 증명합니다.</p>
                    
                    <h4>증명서 구성 요소</h4>
                    <ul>
                        <li><strong>해시 체인:</strong> 위조 불가능한 데이터 연결고리</li>
                        <li><strong>타임스탬프:</strong> 정확한 시간 기록</li>
                        <li><strong>BLS 서명:</strong> 데이터 무결성 보장</li>
                        <li><strong>Merkle Proof:</strong> 계층별 검증 증거</li>
                        <li><strong>QR 코드:</strong> 제3자가 독립적으로 검증 가능</li>
                    </ul>
                    
                    <h4>활용 예시</h4>
                    <ul>
                        <li>24개월 급여 기록 증명서 자동 발급</li>
                        <li>학력 및 경력 증명</li>
                        <li>의료 이력 증명</li>
                        <li>재산 거래 내역 증명</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 6. 접근 권한 관리 -->
        <div class="accordion-card">
            <div class="accordion-card-header" onclick="toggleAccordion(this)">
                <div class="accordion-icon-title">
                    <span>🔑</span>
                    <span>세밀한 접근 권한 관리</span>
                </div>
                <span class="accordion-arrow">▼</span>
            </div>
            <div class="accordion-content">
                <div style="padding: 20px;">
                    <h4>기본 원칙</h4>
                    <ul>
                        <li>오직 본인만 자신의 데이터에 접근 가능</li>
                        <li>시스템 운영자도 원본 데이터를 볼 수 없음</li>
                        <li>제3자 접근은 본인의 명시적 승인 필요</li>
                    </ul>
                    
                    <h4>제3자 접근 승인 프로세스</h4>
                    <ol>
                        <li>제3자가 데이터 접근 요청</li>
                        <li>본인에게 실시간 알림 전송</li>
                        <li>접근 범위, 기간, 용도 설정</li>
                        <li>시간 제한적 임시 복호화 키 생성</li>
                        <li>모든 접근 내역 감사 로그에 기록</li>
                    </ol>
                    
                    <h4>키 관리 시스템</h4>
                    <ul>
                        <li><strong>Master Key:</strong> PBKDF2HMAC (SHA-256, 100,000 iterations)</li>
                        <li><strong>Secure Enclave:</strong> 하드웨어 기반 안전한 저장소</li>
                        <li><strong>Shamir 비밀 분산:</strong> N개 조각 중 M개로 복구</li>
                        <li><strong>재해 복구:</strong> 단말기 분실 시에도 데이터 복구 가능</li>
                    </ul>
                </div>

    <!-- 검색 바 -->
    <div class="pdv-search-bar">
        <div class="search-input-wrapper">
            <input 
                type="text" 
                class="search-input" 
                id="pdvSearchInput" 
                placeholder="대화 내용, 카테고리, 날짜로 검색하세요..."
                onkeypress="if(event.key==='Enter') searchConversations()"
            >
            <button class="search-button" onclick="searchConversations()">🔍 검색</button>
        </div>
    </div>
        </div>

    <!-- 통계 -->
    <div class="pdv-stats">
        <div class="stat-card">
            <div class="stat-number" id="totalConversations">0</div>
            <div class="stat-label">총 대화</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="thisWeekConversations">0</div>
            <div class="stat-label">이번 주</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="thisMonthConversations">0</div>
            <div class="stat-label">이번 달</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="totalMessages">0</div>
            <div class="stat-label">총 메시지</div>
        </div>
    </div>

    <!-- 대화 목록 -->

    <!-- 핵심 기능 아코디언 -->
    <div style="margin: 3rem 0 2rem 0;">
            </div>
        </div>
    </div>
    <div class="conversation-list" id="conversationList">
        <!-- 대화 카드가 여기에 동적으로 추가됩니다 -->
    </div>

    <!-- 빈 상태 -->
    <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-state-icon">💬</div>
        <div class="empty-state-text">아직 저장된 대화가 없습니다</div>
        <div class="empty-state-subtext">AI 상담을 시작하면 대화 내용이 자동으로 저장됩니다</div>
    </div>

<!-- 대화 상세 보기 모달 -->
<div class="conversation-modal" id="conversationModal" onclick="closeConversationModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2 id="modalTitle">대화 상세</h2>
            <button class="modal-close" onclick="closeConversationModal()">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-metadata" id="modalMetadata"></div>
            <div class="modal-messages" id="modalMessages"></div>
        </div>
    </div>
</div>

</div>

<script>
(function() {
    // PDV 데이터 저장소 (localStorage 사용)
    const PDV_STORAGE_KEY = 'jeju_integrated_pdv';

    // PDV 데이터 구조
    // {
    //   id: timestamp,
    //   category: '카테고리',
    //   service: '서비스명',
    //   timestamp: 'ISO datetime',
    //   who: '사용자',
    //   what: '주제',
    //   when: '날짜/시간',
    //   where: '위치/탭',
    //   why: '목적',
    //   how: '방법/결과',
    //   messages: [{role, content}, ...],
    //   summary: '요약'
    // }

    // 페이지 로드 시 초기화
    function initPDV() {
        loadConversations();
        updateStats();
    }

    // 대화 목록 로드
    function loadConversations() {
        const conversations = getStoredConversations();
        const listContainer = document.getElementById('conversationList');
        const emptyState = document.getElementById('emptyState');

        if (conversations.length === 0) {
            listContainer.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }

        emptyState.style.display = 'none';
        listContainer.innerHTML = '';

        // 최신순으로 정렬
        conversations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        conversations.forEach(conv => {
            const card = createConversationCard(conv);
            listContainer.appendChild(card);
        });
    }

    // 대화 카드 생성
    function createConversationCard(conv) {
        const card = document.createElement('div');
        card.className = 'conversation-card';
        card.onclick = () => showConversationDetail(conv.id);

        const date = new Date(conv.timestamp);
        const dateStr = date.toLocaleDateString('ko-KR', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        card.innerHTML = `
            <div class="card-header">
                <span class="card-category">${conv.category || '일반'}</span>
                <span class="card-date">${dateStr}</span>
            </div>
            <div class="card-title">${conv.what || '제목 없음'}</div>
            <div class="card-summary">${conv.summary || '요약 없음'}</div>
            <div class="card-5w1h">
                <div class="w-item">
                    <span class="w-label">Who:</span>
                    <span>${conv.who || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">When:</span>
                    <span>${conv.when || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">Where:</span>
                    <span>${conv.where || '-'}</span>
                </div>
                <div class="w-item">
                    <span class="w-label">Why:</span>
                    <span>${conv.why || '-'}</span>
                </div>
            </div>
        `;

        return card;
    }

    // localStorage에서 대화 가져오기
    function getStoredConversations() {
        const stored = localStorage.getItem(PDV_STORAGE_KEY);
        return stored ? JSON.parse(stored) : [];
    }

    // localStorage에 대화 저장
    function saveConversation(conversation) {
        const conversations = getStoredConversations();
        conversations.push(conversation);
        localStorage.setItem(PDV_STORAGE_KEY, JSON.stringify(conversations));
    }

    // 통계 업데이트
    function updateStats() {
        const conversations = getStoredConversations();
        const now = new Date();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

        const thisWeek = conversations.filter(c => new Date(c.timestamp) > weekAgo).length;
        const thisMonth = conversations.filter(c => new Date(c.timestamp) > monthStart).length;
        const totalMessages = conversations.reduce((sum, c) => sum + (c.messages?.length || 0), 0);

        document.getElementById('totalConversations').textContent = conversations.length;
        document.getElementById('thisWeekConversations').textContent = thisWeek;
        document.getElementById('thisMonthConversations').textContent = thisMonth;
        document.getElementById('totalMessages').textContent = totalMessages;
    }

    // 대화 상세 보기 (다음 단계에서 구현)
    

    // 검색 (다음 단계에서 구현)
    window.searchConversations = function() {
        const query = document.getElementById('pdvSearchInput').value;
        alert('검색 기능은 다음 단계에서 구현됩니다. 검색어: ' + query);
    };

    // 전역 함수로 노출 (다른 탭에서 호출 가능)
    window.saveToPDV = function(conversationData) {
        saveConversation(conversationData);
        console.log('PDV에 대화 저장됨:', conversationData);
    };

    // 페이지 로드 시 초기화
    setTimeout(initPDV, 100);

    // 테스트용 샘플 데이터 추가 함수
    window.addSamplePDVData = function() {
        const sample = {
            id: Date.now(),
            category: '의료',
            service: '진료 예약',
            timestamp: new Date().toISOString(),
            who: '사용자',
            what: '정형외과 진료 예약 문의',
            when: new Date().toLocaleString('ko-KR'),
            where: '의료 탭',
            why: '무릎 통증 진료',
            how: 'AI 상담을 통해 예약 방법 안내받음',
            messages: [
                { role: 'user', content: '정형외과 예약하고 싶어요' },
                { role: 'assistant', content: '정형외과 예약을 도와드리겠습니다...' }
            ],
            summary: '정형외과 예약 방법에 대해 상담하고 온라인 예약 링크를 받았습니다.'
        };
        saveToPDV(sample);
        loadConversations();
        updateStats();
        alert('샘플 데이터가 추가되었습니다!');
    };
    // 대화 상세 보기
    function showConversationDetail(id) {
        const conversations = getStoredConversations();
        const conv = conversations.find(c => c.id === id);
        
        if (!conv) {
            alert('대화를 찾을 수 없습니다.');
            return;
        }
        
        const modal = document.getElementById('conversationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMetadata = document.getElementById('modalMetadata');
        const modalMessages = document.getElementById('modalMessages');
        
        if (!modal) return;
        
        // 제목 설정
        modalTitle.textContent = conv.what || '대화 상세';
        
        // 메타데이터 설정
        modalMetadata.innerHTML = `
            <div class="metadata-grid">
                <div class="metadata-item">
                    <span class="metadata-label">Who:</span>
                    <span class="metadata-value">${conv.who || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">When:</span>
                    <span class="metadata-value">${conv.when || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Where:</span>
                    <span class="metadata-value">${conv.where || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Why:</span>
                    <span class="metadata-value">${conv.why || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">How:</span>
                    <span class="metadata-value">${conv.how || '-'}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Category:</span>
                    <span class="metadata-value">${conv.category || '-'}</span>
                </div>
            </div>
        `;
        
        // 메시지 설정
        if (conv.messages && conv.messages.length > 0) {
            modalMessages.innerHTML = conv.messages.map(msg => {
                const roleText = msg.role === 'user' ? 'You' : 'AI';
                return `
                    <div class="modal-message ${msg.role}">
                        <div class="message-role">${roleText}</div>
                        <div class="message-content">${escapeHtml(msg.content)}</div>
                    </div>
                `;
            }).join('');
        } else {
            modalMessages.innerHTML = '<p style="text-align: center; color: #6B7280;">메시지가 없습니다.</p>';
        }
        
        // 모달 표시
        modal.classList.add('active');
    }
    
    // 모달 닫기
    window.closeConversationModal = function(event) {
        const modal = document.getElementById('conversationModal');
        if (modal) {
            modal.classList.remove('active');
        }
    };
    
    // HTML 이스케이프
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

})();

    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        const isActive = header.classList.contains('active');
        
        // 모든 아코디언 닫기
        document.querySelectorAll('.accordion-card-header').forEach(h => {
            h.classList.remove('active');
            h.nextElementSibling.classList.remove('active');
        });
        
        // 클릭한 아코디언만 토글
        if (!isActive) {
            header.classList.add('active');
            content.classList.add('active');
        }
    }
</script>
