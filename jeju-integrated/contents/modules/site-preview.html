<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì´íŠ¸ í”„ë¦¬ë·°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9FAFB;
        }
        
        .preview-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .site-header {
            background: linear-gradient(135deg, #0B4DA2 0%, #003876 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .site-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .site-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0B4DA2;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid #0B4DA2;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .info-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .info-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .info-content {
            flex: 1;
        }
        
        .info-label {
            font-size: 0.875rem;
            color: #6B7280;
            margin-bottom: 0.25rem;
        }
        
        .info-value {
            font-size: 1rem;
            color: #111827;
            font-weight: 500;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .gallery-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: #F9FAFB;
            aspect-ratio: 16/9;
            position: relative;
        }
        
        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .youtube-embed {
            padding-top: 56.25%;
            position: relative;
            background: #000;
        }
        
        .youtube-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .menu-item {
            padding: 1.5rem;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .menu-item:hover {
            border-color: #0B4DA2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(11, 77, 162, 0.15);
        }
        
        .menu-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.5rem;
        }
        
        .menu-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0B4DA2;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.2rem;
            color: #6B7280;
        }
    </style>
</head>
<body>
    <div class="preview-container" id="previewContainer">
        <div class="loading">ğŸ”„ ì‚¬ì´íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <script>
        // YouTube ID ì¶”ì¶œ í•¨ìˆ˜ (ì „ì—­)
        window.extractYouTubeIdPreview = function(url) {
            console.log('ğŸ” extractYouTubeIdPreview í˜¸ì¶œ:', url);
            
            const patterns = [
                /youtube\.com\/watch\?v=([^&]+)/,
                /youtu\.be\/([^?]+)/,
                /youtube\.com\/embed\/([^?]+)/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    console.log('âœ… YouTube ID ì¶”ì¶œ:', match[1]);
                    return match[1];
                }
            }
            
            console.log('âŒ YouTube ID ì¶”ì¶œ ì‹¤íŒ¨');
            return '';
        };
        
        // ì‚¬ì´íŠ¸ ë Œë”ë§
        window.renderSitePreview = function(data) {
            console.log('ğŸ¨ ì‚¬ì´íŠ¸ ë Œë”ë§ ì‹œì‘:', data);
            
            let html = `
                <div class="site-header">
                    <div class="site-title">${data.businessName || 'ì‚¬ì´íŠ¸ ì œëª©'}</div>
                    <div class="site-subtitle">${data.description || ''}</div>
                </div>
            `;
            
            // ê¸°ë³¸ ì •ë³´
            html += `
                <div class="section">
                    <h2 class="section-title">ê¸°ë³¸ ì •ë³´</h2>
                    <div class="info-grid">
                        ${data.businessType ? `<div class="info-item">
                            <div class="info-icon">ğŸ¢</div>
                            <div class="info-content">
                                <div class="info-label">ì—…ì¢…</div>
                                <div class="info-value">${data.businessType}</div>
                            </div>
                        </div>` : ''}
                        ${data.phone ? `<div class="info-item">
                            <div class="info-icon">ğŸ“</div>
                            <div class="info-content">
                                <div class="info-label">ì „í™”ë²ˆí˜¸</div>
                                <div class="info-value">${data.phone}</div>
                            </div>
                        </div>` : ''}
                        ${data.email ? `<div class="info-item">
                            <div class="info-icon">âœ‰ï¸</div>
                            <div class="info-content">
                                <div class="info-label">ì´ë©”ì¼</div>
                                <div class="info-value">${data.email}</div>
                            </div>
                        </div>` : ''}
                        ${data.address ? `<div class="info-item">
                            <div class="info-icon">ğŸ“</div>
                            <div class="info-content">
                                <div class="info-label">ì£¼ì†Œ</div>
                                <div class="info-value">${data.address}</div>
                            </div>
                        </div>` : ''}
                    </div>
                </div>
            `;
            
            // ë©”ë‰´/ì„œë¹„ìŠ¤
            if (data.menu) {
                html += `
                    <div class="section">
                        <h2 class="section-title">ë©”ë‰´</h2>
                        <div class="menu-grid">
                            <div class="menu-item">
                                <div class="menu-name">${data.menu}</div>
                                ${data.price ? `<div class="menu-price">${parseInt(data.price).toLocaleString()}ì›</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ê°¤ëŸ¬ë¦¬ (URL ì§€ì›)
            if (data.gallery && data.gallery.length > 0) {
                console.log('ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬ ë Œë”ë§:', data.gallery);
                
                html += `<div class="section">
                    <h2 class="section-title">ê°¤ëŸ¬ë¦¬</h2>
                    <div class="gallery-grid">
                        ${data.gallery.map(file => {
                            console.log('íŒŒì¼ ì²˜ë¦¬:', file);
                            
                            if (file.isUrl) {
                                // URL ë§í¬ì¸ ê²½ìš°
                                if (file.type === 'image') {
                                    return `<div class="gallery-item"><img src="${file.url}" alt="${file.name}"></div>`;
                                } else if (file.type === 'video') {
                                    if (file.mimeType === 'video/youtube') {
                                        // YouTube ì„ë² ë“œ
                                        const videoId = window.extractYouTubeIdPreview(file.url);
                                        console.log('YouTube ì„ë² ë“œ:', videoId);
                                        return `<div class="gallery-item youtube-embed">
                                            <iframe 
                                                src="https://www.youtube.com/embed/${videoId}" 
                                                frameborder="0" 
                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                allowfullscreen>
                                            </iframe>
                                        </div>`;
                                    } else {
                                        return `<div class="gallery-item"><video src="${file.url}" controls></video></div>`;
                                    }
                                } else if (file.type === 'audio') {
                                    return `<div class="gallery-item" style="display:flex;align-items:center;justify-content:center;"><audio src="${file.url}" controls style="width:90%;"></audio></div>`;
                                }
                            } else {
                                // Base64 íŒŒì¼ì¸ ê²½ìš°
                                if (file.type === 'image') {
                                    return `<div class="gallery-item"><img src="${file.data}" alt="${file.name}"></div>`;
                                } else if (file.type === 'video') {
                                    return `<div class="gallery-item"><video src="${file.data}" controls></video></div>`;
                                } else if (file.type === 'audio') {
                                    return `<div class="gallery-item" style="display:flex;align-items:center;justify-content:center;"><audio src="${file.data}" controls style="width:90%;"></audio></div>`;
                                }
                            }
                            return '';
                        }).join('')}
                    </div>
                </div>`;
            }
            
            // ì¶”ê°€ ì •ë³´
            const additionalInfo = [];
            if (data.businessHours) additionalInfo.push(`â° ì˜ì—…ì‹œê°„: ${data.businessHours}`);
            if (data.parking) additionalInfo.push(`ğŸ…¿ï¸ ì£¼ì°¨: ${data.parking}`);
            if (data.paymentMethods) additionalInfo.push(`ğŸ’³ ê²°ì œ: ${data.paymentMethods}`);
            
            if (additionalInfo.length > 0) {
                html += `
                    <div class="section">
                        <h2 class="section-title">ë¶€ê°€ ì •ë³´</h2>
                        <div class="info-grid">
                            ${additionalInfo.map(info => `<div class="info-value">${info}</div>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('previewContainer').innerHTML = html;
            console.log('âœ… ë Œë”ë§ ì™„ë£Œ');
        }
        
        // URLì—ì„œ siteId ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const siteId = urlParams.get('siteId');
        
        console.log('ğŸ” ì‚¬ì´íŠ¸ ID:', siteId);
        
        if (siteId) {
            const sites = JSON.parse(localStorage.getItem('aiSites') || '[]');
            console.log('ğŸ’¾ ì „ì²´ ì‚¬ì´íŠ¸:', sites);
            
            const site = sites.find(s => s.id === siteId);
            console.log('ğŸ¯ ì„ íƒëœ ì‚¬ì´íŠ¸:', site);
            
            if (site) {
                renderSite(site);
            } else {
                document.getElementById('previewContainer').innerHTML = `
                    <div class="loading">âŒ ì‚¬ì´íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                `;
            }
        } else {
            document.getElementById('previewContainer').innerHTML = `
                <div class="loading">âŒ ì‚¬ì´íŠ¸ IDê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            `;
        }
        
        // ì „ì—­ í•¨ìˆ˜ í™•ì¸
        console.log('ğŸ” ì „ì—­ í•¨ìˆ˜ í™•ì¸:', typeof window.extractYouTubeIdPreview);
    </script>
</body>
</html>
