<style>
    .chat-generator {
        background: white;
        border: 2px solid #E5E7EB;
        margin: 2rem 0;
        display: flex;
        flex-direction: column;
        height: 600px;
    }
    
    .chat-gen-header {
        background: #0B4DA2;
        color: white;
        padding: 1.5rem;
        border-bottom: 2px solid #003876;
    }
    
    .chat-gen-header h2 {
        margin: 0 0 0.5rem 0;
        font-size: 20px;
        font-weight: 700;
    }
    
    .chat-gen-header p {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
    }
    
    .chat-gen-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        background: #F9FAFB;
    }
    
    .chat-gen-message {
        margin-bottom: 1rem;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .chat-gen-message.ai {
        text-align: left;
    }
    
    .chat-gen-message.user {
        text-align: right;
    }
    
    .gen-message-bubble {
        display: inline-block;
        max-width: 80%;
        padding: 1rem;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .gen-message-bubble.ai {
        background: white;
        border: 2px solid #E5E7EB;
        color: #1F2937;
    }
    
    .gen-message-bubble.user {
        background: #0B4DA2;
        color: white;
    }
    
    .chat-gen-input-area {
        padding: 1.5rem;
        background: white;
        border-top: 2px solid #E5E7EB;
    }
    
    .chat-gen-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #E5E7EB;
        font-size: 14px;
        resize: none;
        margin-bottom: 0.75rem;
    }
    
    .chat-gen-input:focus {
        outline: none;
        border-color: #0B4DA2;
    }
    
    .chat-gen-btn {
        background: #0B4DA2;
        color: white;
        padding: 0.75rem 2rem;
        border: none;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        width: 100%;
    }
    
    .chat-gen-btn:hover {
        background: #003876;
    }
    
    .chat-gen-btn:disabled {
        background: #9CA3AF;
        cursor: not-allowed;
    }
    
    .info-collected {
        background: #F0FDF4;
        border-left: 4px solid #22C55E;
        padding: 0.75rem;
        margin-top: 0.5rem;
        font-size: 13px;
        color: #166534;
    }
    
    .thinking {
        opacity: 0.6;
        font-style: italic;
    }
</style>

<div class="chat-generator">
    <div class="chat-gen-header">
        <h2>ğŸ¤– ì‚¬ì´íŠ¸ ìƒì„± AI (DeepSeek R1 ì—°ë™)</h2>
        <p>ìì—°ì–´ë¡œ í¸í•˜ê²Œ ëŒ€í™”í•˜ì„¸ìš”</p>
    </div>
    
    <div class="chat-gen-messages" id="genChatMessages">
        <div class="chat-gen-message ai">
            <div class="gen-message-bubble ai">
                ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” DeepSeek R1 ê¸°ë°˜ ì‚¬ì´íŠ¸ ìƒì„± AIì…ë‹ˆë‹¤. ğŸ˜Š<br><br>
                ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ë©´ì„œ ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.<br>
                í•œ ë²ˆì— ì—¬ëŸ¬ ì •ë³´ë¥¼ ë§ì”€í•˜ì…”ë„ ë©ë‹ˆë‹¤!<br><br>
                ì˜ˆ: "ì‚¬ì—…ìì´ê³ , ë‹¤ì‚¬ë‘ íšŸì§‘ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì œì£¼ì‹œì—ì„œ ì°¸ì¹˜íšŒë¥¼ íŒ”ê³  ìˆì–´ìš”. ì „í™”ëŠ” 064-123-4567ì´ì—ìš”."
            </div>
        </div>
    </div>
    
    <div class="chat-gen-input-area">
        <textarea 
            class="chat-gen-input" 
            id="genChatInput" 
            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
            rows="2"
            onkeypress="handleGenKeypress(event)"
        ></textarea>
        <button class="chat-gen-btn" id="genSendBtn" onclick="sendGenMessage()">ì „ì†¡</button>
    </div>
</div>

<script>
(function() {
    // DeepSeek API ì„¤ì •
    const DEEPSEEK_API_KEY = 'sk-17c1624e3b26497fbca6262419b032f5'; // ì—¬ê¸°ì— API í‚¤ ì…ë ¥
    const DEEPSEEK_API_URL = 'http://100.30.14.224:3001';
    
    const siteData = {
        businessType: null,
        businessName: null,
        businessNumber: null,
        phone: null,
        email: null,
        address: null,
        industry: null,
        description: null,
        hours: null,
        website: null
    };
    
    let conversationHistory = [];
    let isProcessing = false;
    
    window.handleGenKeypress = function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendGenMessage();
        }
    };
    
    window.sendGenMessage = async function() {
        if (isProcessing) return;
        
        const input = document.getElementById('genChatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        isProcessing = true;
        document.getElementById('genSendBtn').disabled = true;
        
        // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
        addGenMessage(message, 'user');
        input.value = '';
        
        // AI ì‘ë‹µ ìƒì„±
        await getAIResponse(message);
        
        isProcessing = false;
        document.getElementById('genSendBtn').disabled = false;
    };
    
    async function getAIResponse(userMessage) {
        // ëŒ€í™” ì´ë ¥ì— ì¶”ê°€
        conversationHistory.push({
            role: 'user',
            content: userMessage
        });
        
        // Thinking ë©”ì‹œì§€ í‘œì‹œ
        const thinkingId = addGenMessage('ìƒê°í•˜ëŠ” ì¤‘...', 'ai', 'thinking');
        
        try {
            // DeepSeek API í˜¸ì¶œ
            const response = await fetch(DEEPSEEK_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'deepseek-reasoner',
                    messages: [
                        {
                            role: 'system',
                            content: getSystemPrompt()
                        },
                        ...conversationHistory
                    ],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨: ' + response.status);
            }
            
            const data = await response.json();
            const aiMessage = data.choices[0].message.content;
            
            // Thinking ë©”ì‹œì§€ ì œê±°
            removeMessage(thinkingId);
            
            // AI ì‘ë‹µ í‘œì‹œ
            addGenMessage(aiMessage, 'ai');
            
            // ëŒ€í™” ì´ë ¥ì— ì¶”ê°€
            conversationHistory.push({
                role: 'assistant',
                content: aiMessage
            });
            
            // JSON íŒŒì‹± ì‹œë„ (ì •ë³´ ì¶”ì¶œ)
            extractInfoFromResponse(aiMessage);
            
            // ì™„ë£Œ í™•ì¸
            if (checkCompletion()) {
                setTimeout(() => completeSiteGeneration(), 1000);
            }
            
        } catch (error) {
            console.error('DeepSeek API ì˜¤ë¥˜:', error);
            removeMessage(thinkingId);
            addGenMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'ai');
        }
    }
    
    function getSystemPrompt() {
        const collectedInfo = Object.entries(siteData)
            .filter(([key, value]) => value !== null && value !== '')
            .map(([key, value]) => `${key}: ${JSON.stringify(value)}`)
            .join(', ');
        
        // ì—…ì¢…ë³„ ì •ë¶€ í‘œì¤€ ì‚¬ì´íŠ¸ êµ¬ì¡°
        const siteStructures = {
            food: {
                name: 'ìŒì‹ì ',
                sections: [
                    'hero (ëŒ€í‘œ ì´ë¯¸ì§€, ìŠ¬ë¡œê±´)',
                    'menu (ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´, ê°€ê²©, ì„¤ëª…, ë¦¬ë·°)',
                    'facilities (ì£¼ì°¨, ë£¸, WiFi, í‚¤ì¦ˆì¡´)',
                    'chef (ì…°í”„ ì†Œê°œ)',
                    'gallery (ë§¤ì¥ ì‚¬ì§„)',
                    'hours (ì˜ì—…ì‹œê°„)',
                    'reservations (ì˜ˆì•½ ë°©ë²•)',
                    'contact (ì—°ë½ì²˜, ì£¼ì†Œ)'
                ],
                questions: [
                    'ëŒ€í‘œ ë©”ë‰´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?',
                    'ë©”ë‰´ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì•Œë ¤ì£¼ì„¸ìš” (ì˜ˆ: íšŒë¥˜, êµ¬ì´ë¥˜, íƒ•ë¥˜)',
                    'ê° ë©”ë‰´ì˜ ê°€ê²©ì€?',
                    'ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´ì˜ íŠ¹ì§•ì€?',
                    'ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ëŠ”?',
                    'ë£¸ì´ë‚˜ ë‹¨ì²´ì„ì´ ìˆë‚˜ìš”?',
                    'ì…°í”„ë‹˜ ê²½ë ¥ì€?',
                    'ì˜ˆì•½ í•„ìˆ˜ì¸ê°€ìš”?',
                    'ì£¼ìš” ê³ ê° ë¦¬ë·°ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”'
                ]
            },
            government: {
                name: 'ê´€ê³µì„œ',
                sections: [
                    'hero (ë¶€ì„œëª…, ë¯¸ì…˜)',
                    'departments (ë¶€ì„œ êµ¬ì„±)',
                    'services (ì œê³µ ì„œë¹„ìŠ¤, ì²˜ë¦¬ì‹œê°„, ìˆ˜ìˆ˜ë£Œ, ì´ìš©ì í‰ê°€)',
                    'documents (í•„ìš” ì„œë¥˜)',
                    'hours (ë¯¼ì› ì‹œê°„)',
                    'contact (ì „í™”, ì´ë©”ì¼)',
                    'faq (ìì£¼ ë¬»ëŠ” ì§ˆë¬¸)',
                    'announcements (ê³µì§€ì‚¬í•­)'
                ],
                questions: [
                    'ë¶€ì„œì˜ ì£¼ìš” ì—…ë¬´ëŠ”?',
                    'ì œê³µí•˜ëŠ” ë¯¼ì› ì„œë¹„ìŠ¤ ëª©ë¡ì€?',
                    'ê° ì„œë¹„ìŠ¤ì˜ ì²˜ë¦¬ ì‹œê°„ì€?',
                    'í•„ìš”í•œ ì„œë¥˜ëŠ”?',
                    'ìˆ˜ìˆ˜ë£Œê°€ ìˆë‚˜ìš”?',
                    'ì˜¨ë¼ì¸ ì‹ ì²­ ê°€ëŠ¥í•œê°€ìš”?',
                    'ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ 3ê°€ì§€ëŠ”?',
                    'í˜„ì¬ ê³µì§€ì‚¬í•­ì€?'
                ]
            },
            medical: {
                name: 'ì˜ë£Œê¸°ê´€',
                sections: [
                    'hero (ë³‘ì›ëª…, ì „ë¬¸ ë¶„ì•¼)',
                    'specialties (ì§„ë£Œ ê³¼ëª©)',
                    'doctors (ì˜ë£Œì§„, ê²½ë ¥, ì „ë¬¸ ë¶„ì•¼)',
                    'services (ì§„ë£Œ ì„œë¹„ìŠ¤, í™˜ì í‰ê°€)',
                    'facilities (ì¥ë¹„, ì‹œì„¤)',
                    'insurance (ë³´í—˜)',
                    'hours (ì§„ë£Œ ì‹œê°„)',
                    'appointments (ì˜ˆì•½ ë°©ë²•)',
                    'reviews (í™˜ì í›„ê¸°)'
                ],
                questions: [
                    'ì „ë¬¸ ì§„ë£Œ ê³¼ëª©ì€?',
                    'ì˜ë£Œì§„ êµ¬ì„±ì€? (ì´ë¦„, ì „ë¬¸ë¶„ì•¼, ê²½ë ¥)',
                    'ì£¼ìš” ì§„ë£Œ ì„œë¹„ìŠ¤ëŠ”?',
                    'ë³´ìœ  ì˜ë£Œ ì¥ë¹„ëŠ”?',
                    'ê°€ëŠ¥í•œ ë³´í—˜ì€?',
                    'ê³¼ëª©ë³„ ì§„ë£Œ ì‹œê°„ì€?',
                    'ì˜ˆì•½ì€ ì–´ë–»ê²Œ?',
                    'ì£¼ìš” í™˜ì í›„ê¸°ëŠ”?'
                ]
            },
            retail: {
                name: 'ì†Œë§¤ì—…',
                sections: [
                    'hero (ë¸Œëœë“œ ìŠ¤í† ë¦¬)',
                    'products (ì¹´í…Œê³ ë¦¬, ìƒí’ˆ, ê°€ê²©, êµ¬ë§¤ì ë¦¬ë·°)',
                    'brands (ì·¨ê¸‰ ë¸Œëœë“œ)',
                    'delivery (ë°°ì†¡ ì •ë³´)',
                    'payment (ê²°ì œ ìˆ˜ë‹¨)',
                    'gallery (ë§¤ì¥/ìƒí’ˆ ì‚¬ì§„)',
                    'hours (ì˜ì—…ì‹œê°„)',
                    'returns (êµí™˜/í™˜ë¶ˆ)',
                    'contact (ì—°ë½ì²˜)'
                ],
                questions: [
                    'ì£¼ë ¥ ìƒí’ˆ ì¹´í…Œê³ ë¦¬ëŠ”?',
                    'ê° ì¹´í…Œê³ ë¦¬ë³„ ëŒ€í‘œ ìƒí’ˆì€?',
                    'ìƒí’ˆë³„ ê°€ê²©ëŒ€ëŠ”?',
                    'ì·¨ê¸‰ ë¸Œëœë“œëŠ”?',
                    'ë°°ì†¡ ë°©ë²•ê³¼ ê¸°ê°„ì€?',
                    'ê²°ì œ ìˆ˜ë‹¨ì€?',
                    'êµí™˜/í™˜ë¶ˆ ì •ì±…ì€?',
                    'ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìƒí’ˆê³¼ ë¦¬ë·°ëŠ”?'
                ]
            }
        };
        
        const currentStructure = siteData.industry ? siteStructures[siteData.industry] : null;
        
        let prompt = `ë‹¹ì‹ ì€ ì •ë¶€ ê³µì‹ ì›¹ì‚¬ì´íŠ¸ ë””ìì¸ ê°€ì´ë“œë¥¼ ì¤€ìˆ˜í•˜ëŠ” ì‚¬ì´íŠ¸ ìƒì„± AIì…ë‹ˆë‹¤.

ã€ ì„ë¬´ ã€‘
ìƒë‹´ìì™€ ëŒ€í™”í•˜ì—¬ ${currentStructure ? currentStructure.name : 'ì‚¬ì´íŠ¸'} í‘œì¤€ ì›¹ì‚¬ì´íŠ¸ë¥¼ êµ¬ì¶•í•  ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.

ã€ ì •ë¶€ ì›¹ì‚¬ì´íŠ¸ í‘œì¤€ ì›ì¹™ ã€‘
1. ì ‘ê·¼ì„±: ëª¨ë“  ì •ë³´ê°€ ëª…í™•í•˜ê³  ì°¾ê¸° ì‰¬ì›Œì•¼ í•¨
2. íˆ¬ëª…ì„±: ê°€ê²©, ì„œë¹„ìŠ¤, ë¦¬ë·° ë“± ëª¨ë“  ì •ë³´ ê³µê°œ
3. ì‚¬ìš©ì ì¤‘ì‹¬: ì´ìš©ì í‰ê°€ì™€ í”¼ë“œë°± ìˆ˜ì§‘
4. êµ¬ì¡°í™”: ì„¹ì…˜ë³„ë¡œ ì²´ê³„ì ìœ¼ë¡œ ì •ë³´ êµ¬ì„±
`;

        if (!siteData.industry) {
            prompt += `
ã€ 1ë‹¨ê³„: ì—…ì¢… íŒŒì•… ã€‘
ë¨¼ì € ìƒë‹´ìì˜ ì—…ì¢…ì„ íŒŒì•…í•˜ì„¸ìš”:
- ìŒì‹ì  (food)
- ê´€ê³µì„œ (government)  
- ì˜ë£Œê¸°ê´€ (medical)
- ì†Œë§¤ì—… (retail)
- ì„œë¹„ìŠ¤ì—… (service)
- êµìœ¡ (education)

ì§ˆë¬¸: "ì–´ë–¤ ì—…ì¢…ì´ì‹ ê°€ìš”?" ë˜ëŠ” "ë¬´ìŠ¨ ì¼ì„ í•˜ì‹œë‚˜ìš”?"
`;
        } else {
            prompt += `
ã€ í˜„ì¬ ì—…ì¢…: ${currentStructure.name} ã€‘

ã€ ìˆ˜ì§‘í•  ì‚¬ì´íŠ¸ êµ¬ì¡° ã€‘
${currentStructure.sections.map((s, i) => `${i + 1}. ${s}`).join('\n')}

ã€ ì§ˆë¬¸ ê°€ì´ë“œ ã€‘
ë‹¤ìŒ ì§ˆë¬¸ë“¤ì„ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”ë¡œ í’€ì–´ì„œ ë¬¼ì–´ë³´ì„¸ìš”:
${currentStructure.questions.map((q, i) => `${i + 1}. ${q}`).join('\n')}

ã€ ì¤‘ìš”: ë¦¬ë·°/í‰ê°€ ìˆ˜ì§‘ ã€‘
ëª¨ë“  ìƒí’ˆ/ì„œë¹„ìŠ¤/ë©”ë‰´ í•­ëª©ë§ˆë‹¤ êµ¬ë§¤ì/ì´ìš©ì í‰ê°€ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”:
- í‰ê°€ì ì´ë¦„ (ë˜ëŠ” ìµëª…)
- í‰ì  (5ì  ë§Œì )
- ë¦¬ë·° ë‚´ìš©
- ë‚ ì§œ

ì˜ˆì‹œ:
"ê´‘ì–´íšŒì— ëŒ€í•œ ê³ ê° ë¦¬ë·°ê°€ ìˆë‚˜ìš”?"
â†’ reviews: [{"author": "ê¹€ì² ìˆ˜", "rating": 5, "comment": "ì‹ ì„ í•˜ê³  ë§›ìˆì–´ìš”", "date": "2025-12"}]
`;
        }

        prompt += `

ã€ í˜„ì¬ ìˆ˜ì§‘ëœ ì •ë³´ ã€‘
${collectedInfo || 'ì—†ìŒ'}

ã€ JSON êµ¬ì¡° ì˜ˆì‹œ ã€‘
${currentStructure && currentStructure.name === 'ìŒì‹ì ' ? `
{
  "hero": {
    "title": "ë‹¤ì‚¬ë‘ íšŸì§‘",
    "slogan": "ì œì£¼ ë°”ë‹¤ì˜ ì‹ ì„ í•¨ì„ ê·¸ëŒ€ë¡œ",
    "image": "hero.jpg"
  },
  "menu": {
    "categories": [
      {
        "name": "íšŒë¥˜",
        "items": [
          {
            "name": "ê´‘ì–´íšŒ",
            "price": "30,000ì›",
            "description": "ë‹¹ì¼ ì œì£¼ ë°”ë‹¤ì—ì„œ ì¡ì€ ê´‘ì–´",
            "image": "gwangeo.jpg",
            "reviews": [
              {"author": "ê¹€ì² ìˆ˜", "rating": 5, "comment": "ì‹ ì„ í•˜ê³  ë§›ìˆì–´ìš”", "date": "2025-12-10"},
              {"author": "ì´ì˜í¬", "rating": 4, "comment": "ê°€ê²©ëŒ€ë¹„ ì¢‹ì•„ìš”", "date": "2025-12-11"}
            ]
          }
        ]
      }
    ]
  },
  "facilities": {
    "parking": "ê°€ëŠ¥ (10ëŒ€)",
    "rooms": "ë‹¨ì²´ì„ 3ê°œ",
    "wifi": "ë¬´ë£Œ",
    "kids_zone": "ìˆìŒ"
  },
  "chef": {
    "name": "ë°•ìš”ë¦¬",
    "experience": "20ë…„",
    "specialty": "í™œì–´íšŒ"
  }
}` : currentStructure && currentStructure.name === 'ê´€ê³µì„œ' ? `
{
  "hero": {
    "title": "ì œì£¼ì‹œì²­ ë¯¼ì›ì‹¤",
    "mission": "ì‹œë¯¼ì„ ìœ„í•œ ë¹ ë¥´ê³  ì •í™•í•œ ì„œë¹„ìŠ¤"
  },
  "services": [
    {
      "name": "ì£¼ë¯¼ë“±ë¡ ë°œê¸‰",
      "time": "ì¦‰ì‹œ",
      "fee": "ë¬´ë£Œ",
      "documents": ["ì‹ ë¶„ì¦"],
      "reviews": [
        {"author": "ì‹œë¯¼A", "rating": 5, "comment": "ë¹ ë¥´ê³  ì¹œì ˆí•´ìš”", "date": "2025-12"}
      ]
    }
  ]
}` : ''}

ã€ ìˆ˜ì§‘ ê·œì¹™ ã€‘
1. í•œ ë²ˆì— 2-3ê°œ ì§ˆë¬¸ (ë„ˆë¬´ ë§ìœ¼ë©´ ë¶€ë‹´)
2. ëŒ€í™” ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ê°€ê¸°
3. ì‚¬ìš©ìê°€ í•œ ë²ˆì— ì—¬ëŸ¬ ì •ë³´ ì œê³µ ê°€ëŠ¥
4. ì„¹ì…˜ë³„ë¡œ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì§‘
5. ë¦¬ë·°ëŠ” ë°˜ë“œì‹œ ë°°ì—´ë¡œ ì €ì¥
6. ê°€ê²©, ì‹œê°„ ë“± êµ¬ì²´ì  ì •ë³´ ìˆ˜ì§‘
7. 10-15ê°œ ì´ìƒì˜ ì§ˆë¬¸ì„ í†µí•´ í’ë¶€í•œ ì •ë³´ í™•ë³´

ã€ ì‘ë‹µ í˜•ì‹ ã€‘
ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” + ì •ë³´ íŒŒì•… ì‹œ JSON ì¶”ê°€:
JSON_DATA: {"field": "value", "nested": {"key": "value"}}

ì™„ë£Œ ì¡°ê±´:
- ê¸°ë³¸ ì •ë³´ (ì´ë¦„, ì—°ë½ì²˜, ì£¼ì†Œ) âœ“
- ì—…ì¢…ë³„ í•µì‹¬ ì„¹ì…˜ 3ê°œ ì´ìƒ âœ“
- ìƒí’ˆ/ì„œë¹„ìŠ¤ë³„ ë¦¬ë·° ìˆ˜ì§‘ âœ“
â†’ "ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!" ì¶œë ¥
`;

        return prompt;
    }
    
    function extractInfoFromResponse(aiMessage) {
        // JSON ë°ì´í„° ì¶”ì¶œ
        const jsonMatch = aiMessage.match(/JSON_DATA:\s*({[^}]+})/);
        if (jsonMatch) {
            try {
                const extractedData = JSON.parse(jsonMatch[1]);
                Object.assign(siteData, extractedData);
                showCollectedInfo();
            } catch (e) {
                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
            }
        }
    }
    
    function checkCompletion() {
        const required = ['businessType', 'businessName', 'phone', 'email', 'address', 'industry', 'description'];
        return required.every(field => siteData[field]);
    }
    
    function showCollectedInfo() {
        const info = [];
        if (siteData.businessType) info.push(`ìœ í˜•: ${getBusinessTypeText(siteData.businessType)}`);
        if (siteData.businessName) info.push(`ìƒí˜¸: ${siteData.businessName}`);
        if (siteData.phone) info.push(`ì „í™”: ${siteData.phone}`);
        if (siteData.email) info.push(`ì´ë©”ì¼: ${siteData.email}`);
        if (siteData.address) info.push(`ì£¼ì†Œ: ${siteData.address}`);
        if (siteData.industry) info.push(`ì—…ì¢…: ${getIndustryText(siteData.industry)}`);
        
        if (info.length > 0) {
            const existingInfo = document.querySelector('.info-collected');
            if (existingInfo) existingInfo.remove();
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'info-collected';
            infoDiv.innerHTML = '<strong>ğŸ“ ìˆ˜ì§‘ëœ ì •ë³´:</strong><br>' + info.join(' | ');
            
            const container = document.getElementById('genChatMessages');
            container.appendChild(infoDiv);
            container.scrollTop = container.scrollHeight;
        }
    }
    
    function completeSiteGeneration() {
        const finalData = {
            ...siteData,
            id: Date.now().toString(),
            createdAt: new Date().toISOString()
        };
        
        const sites = JSON.parse(localStorage.getItem('aiSites') || '[]');
        sites.push(finalData);
        localStorage.setItem('aiSites', JSON.stringify(sites));
        
        addGenMessage(
            `ğŸ‰ ì™„ë£Œ!<br><br><strong>${siteData.businessName}</strong> ì‚¬ì´íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ì ì‹œ í›„ í”„ë¦¬ë·°ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤...`,
            'ai'
        );
        
        setTimeout(() => {
            if (window.loadSitePreview) {
                window.loadSitePreview(finalData);
                document.getElementById('previewModule').scrollIntoView({ behavior: 'smooth' });
            }
        }, 2000);
    }
    
    let messageIdCounter = 0;
    function addGenMessage(text, sender, className = '') {
        const container = document.getElementById('genChatMessages');
        const div = document.createElement('div');
        const id = 'msg-' + (++messageIdCounter);
        div.id = id;
        div.className = `chat-gen-message ${sender} ${className}`;
        div.innerHTML = `<div class="gen-message-bubble ${sender}">${text}</div>`;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
        return id;
    }
    
    function removeMessage(id) {
        const msg = document.getElementById(id);
        if (msg) msg.remove();
    }
    
    function getBusinessTypeText(type) {
        return { 'individual': 'ê°œì¸', 'business': 'ì‚¬ì—…ì', 'corporation': 'ë²•ì¸' }[type] || type;
    }
    
    function getIndustryText(industry) {
        const map = { 'food': 'ìŒì‹ì ', 'retail': 'ì†Œë§¤ì—…', 'service': 'ì„œë¹„ìŠ¤ì—…', 'manufacturing': 'ì œì¡°ì—…', 'education': 'êµìœ¡', 'medical': 'ì˜ë£Œ', 'finance': 'ê¸ˆìœµ', 'transport': 'ìš´ìˆ˜', 'other': 'ê¸°íƒ€' };
        return map[industry] || industry;
    }
})();
</script>
