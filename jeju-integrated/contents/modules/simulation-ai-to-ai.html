<style>
    .simulation-container {
        max-width: 1600px;
        margin: 3rem auto;
        padding: 2rem;
        background: white;
        border: 2px solid #0B4DA2;
        border-radius: 8px;
    }
    
    .simulation-header {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #E5E7EB;
    }
    
    .simulation-header h2 {
        color: #0B4DA2;
        font-size: 24px;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
    }
    
    .simulation-header p {
        color: #6B7280;
        font-size: 14px;
        margin: 0;
    }
    
    .simulation-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .panel {
        border: 2px solid #E5E7EB;
        border-radius: 8px;
        overflow: hidden;
        background: white;
    }
    
    .panel-header {
        padding: 1rem;
        font-weight: 700;
        font-size: 16px;
        color: white;
    }
    
    .panel-court {
        background: #DC2626;
    }
    
    .panel-log {
        background: #059669;
    }
    
    .panel-personal {
        background: #0B4DA2;
    }
    
    .panel-content {
        padding: 1.5rem;
        min-height: 400px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .document-list {
        margin: 1rem 0;
    }
    
    .document-item {
        padding: 0.75rem;
        margin: 0.5rem 0;
        border: 1px solid #E5E7EB;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .document-item.available {
        background: #F0FDF4;
        border-color: #86EFAC;
    }
    
    .btn-request {
        background: #DC2626;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
    }
    
    .btn-request:hover {
        background: #B91C1C;
    }
    
    .btn-approve {
        background: #059669;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        margin-right: 0.5rem;
    }
    
    .btn-approve:hover {
        background: #047857;
    }
    
    .btn-reject {
        background: #DC2626;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
    }
    
    .btn-reject:hover {
        background: #B91C1C;
    }
    
    .log-entry {
        padding: 0.75rem;
        margin: 0.5rem 0;
        border-left: 4px solid #E5E7EB;
        background: #F9FAFB;
        font-size: 13px;
        line-height: 1.6;
    }
    
    .log-entry.request {
        border-left-color: #DC2626;
    }
    
    .log-entry.approval {
        border-left-color: #059669;
    }
    
    .log-entry.transfer {
        border-left-color: #0B4DA2;
    }
    
    .log-entry.blockchain {
        border-left-color: #7C3AED;
        background: #FAF5FF;
    }
    
    .timestamp {
        color: #6B7280;
        font-size: 11px;
        margin-top: 0.25rem;
    }
    
    .approval-request {
        background: #FEF3C7;
        border: 2px solid #F59E0B;
        padding: 1rem;
        border-radius: 4px;
        margin: 1rem 0;
    }
    
    .approval-request h4 {
        margin: 0 0 0.5rem 0;
        color: #92400E;
        font-size: 14px;
    }
    
    .approval-request p {
        margin: 0.25rem 0;
        font-size: 13px;
        color: #78350F;
    }
    
    .blockchain-hash {
        font-family: monospace;
        font-size: 11px;
        color: #7C3AED;
        background: #F5F3FF;
        padding: 0.5rem;
        border-radius: 4px;
        margin-top: 0.5rem;
        word-break: break-all;
    }
    
    .user-info {
        background: #EFF6FF;
        padding: 1rem;
        border-radius: 4px;
        margin-bottom: 1rem;
    }
    
    .user-info h4 {
        margin: 0 0 0.5rem 0;
        color: #1E3A8A;
        font-size: 14px;
    }
    
    .user-info p {
        margin: 0.25rem 0;
        font-size: 13px;
        color: #1E40AF;
    }
    
    .qr-section {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        text-align: center;
        border: 2px solid #E5E7EB;
    }
    
    .qr-title {
        font-size: 14px;
        font-weight: 600;
        color: #1F2937;
        margin-bottom: 0.5rem;
    }
    
    .qr-code {
        display: inline-block;
        padding: 0.5rem;
        background: white;
        border-radius: 4px;
    }
    
    .qr-description {
        font-size: 12px;
        color: #6B7280;
        margin-top: 0.5rem;
    }
</style>

<div class="simulation-container">
    <div class="simulation-header">
        <h2>ğŸ”„ AI-to-AI ë¬¸ì„œ ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜</h2>
        <p>ë²•ì› ì‚¬ì´íŠ¸ AIì™€ ê°œì¸ ì‚¬ì´íŠ¸ AI ê°„ì˜ ì‹¤ì‹œê°„ ë¬¸ì„œ ìš”ì²­ ë° ì „ì†¡ ê³¼ì •ì„ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    
    <div class="simulation-grid">
        <!-- ë²•ì› ì‚¬ì´íŠ¸ íŒ¨ë„ -->
        <div class="panel">
            <div class="panel-header panel-court">
                âš–ï¸ ì œì£¼ì§€ë°©ë²•ì› AI
            </div>
            <div class="panel-content" id="courtPanel">
                <div class="user-info">
                    <h4>ê¸°ê´€ ì •ë³´</h4>
                    <p><strong>ê¸°ê´€ëª…:</strong> ì œì£¼ì§€ë°©ë²•ì›</p>
                    <p><strong>ë‹´ë‹¹:</strong> ë¯¼ì‚¬ 1ë¶€</p>
                    <p><strong>ì‚¬ê±´ë²ˆí˜¸:</strong> 2025ê°€ë‹¨12345</p>
                </div>
                
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 14px;">ğŸ“„ ìš”ì²­ ê°€ëŠ¥í•œ ì„œë¥˜</h4>
                <div class="document-list">
                    <div class="document-item">
                        <span>ì£¼ë¯¼ë“±ë¡ë“±ë³¸</span>
                        <button class="btn-request" onclick="SimulationAI.requestDocument('ì£¼ë¯¼ë“±ë¡ë“±ë³¸')">ìš”ì²­</button>
                    </div>
                    <div class="document-item">
                        <span>ì£¼ë¯¼ë“±ë¡ì´ˆë³¸</span>
                        <button class="btn-request" onclick="SimulationAI.requestDocument('ì£¼ë¯¼ë“±ë¡ì´ˆë³¸')">ìš”ì²­</button>
                    </div>
                    <div class="document-item">
                        <span>ì¸ê°ì¦ëª…ì„œ</span>
                        <button class="btn-request" onclick="SimulationAI.requestDocument('ì¸ê°ì¦ëª…ì„œ')">ìš”ì²­</button>
                    </div>
                    <div class="document-item">
                        <span>ì¡¸ì—…ì¦ëª…ì„œ</span>
                        <button class="btn-request" onclick="SimulationAI.requestDocument('ì¡¸ì—…ì¦ëª…ì„œ')">ìš”ì²­</button>
                    </div>
                </div>
                
                <div id="courtReceived" style="margin-top: 2rem;"></div>
            </div>
        </div>
        
        <!-- í†µì‹  ë¡œê·¸ íŒ¨ë„ -->
        <div class="panel">
            <div class="panel-header panel-log">
                ğŸ“¡ í†µì‹  ë¡œê·¸
            </div>
            <div class="panel-content" id="logPanel">
                <div class="log-entry">
                    <strong>ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</strong>
                    <div class="timestamp">ì‹œë®¬ë ˆì´ì…˜ ëŒ€ê¸° ì¤‘...</div>
                </div>
            </div>
        </div>
        
        <!-- ê°œì¸ ì‚¬ì´íŠ¸ íŒ¨ë„ -->
        <div class="panel">
            <div class="panel-header panel-personal">
                ğŸ‘¤ ê°œì¸ ì‚¬ì´íŠ¸ AI (í™ê¸¸ë™)
            </div>
            <div class="panel-content" id="personalPanel">
                <div class="user-info">
                    <h4>ê°œì¸ ì •ë³´</h4>
                    <p><strong>ì„±ëª…:</strong> í™ê¸¸ë™</p>
                    <p><strong>ìƒë…„ì›”ì¼:</strong> 1990-01-01</p>
                    <p><strong>ì£¼ì†Œ:</strong> ì œì£¼ì‹œ ì¤‘ì•™ë¡œ 123</p>
                </div>
                
                <div class="qr-section">
                    <div class="qr-title">ğŸ“± ìŠ¤ë§ˆíŠ¸í° ì—°ë™</div>
                    <div class="qr-code" id="qrcode"></div>
                    <div class="qr-description">
                        QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬<br>
                        ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ìŠ¹ì¸í•˜ì„¸ìš”
                    </div>
                </div>
                
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 14px;">ğŸ“‚ ë³´ìœ  ì„œë¥˜</h4>
                <div class="document-list">
                    <div class="document-item available">
                        <span>âœ… ì£¼ë¯¼ë“±ë¡ë“±ë³¸</span>
                    </div>
                    <div class="document-item available">
                        <span>âœ… ì£¼ë¯¼ë“±ë¡ì´ˆë³¸</span>
                    </div>
                    <div class="document-item available">
                        <span>âœ… ì¸ê°ì¦ëª…ì„œ</span>
                    </div>
                    <div class="document-item available">
                        <span>âœ… ì¡¸ì—…ì¦ëª…ì„œ</span>
                    </div>
                </div>
                
                <div id="personalApproval"></div>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    // BroadcastChannel ìƒì„±
    const approvalChannel = new BroadcastChannel('ai-approval-channel');
    
    // ìŠ¤ë§ˆíŠ¸í° ì•±ìœ¼ë¡œë¶€í„° ì‘ë‹µ ìˆ˜ì‹ 
    approvalChannel.onmessage = (event) => {
        console.log('ğŸ“± ìŠ¤ë§ˆíŠ¸í° ì‘ë‹µ ìˆ˜ì‹ :', event.data);
        
        if (event.data.type === 'APPROVAL_RESPONSE') {
            if (event.data.approved) {
                window.SimulationAI.handlePhoneApproval(event.data);
            } else {
                window.SimulationAI.handlePhoneRejection(event.data);
            }
        }
    };
    
    window.SimulationAI = {
        currentRequest: null,
        transactionId: 0,
        approvalChannel: approvalChannel,
        
        // í˜„ì¬ ì‹œê°„ ë°˜í™˜
        getTimestamp: function() {
            const now = new Date();
            return now.toLocaleTimeString('ko-KR');
        },
        
        // ë¸”ë¡ì²´ì¸ í•´ì‹œ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜)
        generateHash: function() {
            return 'OH_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        },
        
        // ë¡œê·¸ ì¶”ê°€
        addLog: function(message, type = '') {
            const logPanel = document.getElementById('logPanel');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `
                <div>${message}</div>
                <div class="timestamp">${this.getTimestamp()}</div>
            `;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
        },
        
        // 1ë‹¨ê³„: ë²•ì› AI â†’ ê°œì¸ AI ì„œë¥˜ ìš”ì²­
        requestDocument: function(docName) {
            if (this.currentRequest) {
                alert('ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            this.transactionId++;
            this.currentRequest = {
                id: this.transactionId,
                docName: docName,
                from: 'ì œì£¼ì§€ë°©ë²•ì›',
                to: 'í™ê¸¸ë™',
                timestamp: new Date().toISOString()
            };
            
            this.addLog(`
                <strong>ğŸ“¤ ì„œë¥˜ ìš”ì²­ ë°œì†¡</strong><br>
                <strong>ìš”ì²­ ê¸°ê´€:</strong> ì œì£¼ì§€ë°©ë²•ì›<br>
                <strong>ì„œë¥˜ëª…:</strong> ${docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${this.transactionId}
            `, 'request');
            
            // 2ë‹¨ê³„ë¡œ ì§„í–‰
            setTimeout(() => this.showApprovalRequest(docName), 1000);
        },
        
        // 2ë‹¨ê³„: ê°œì¸ì—ê²Œ ìŠ¹ì¸ ìš”ì²­ (ì›¹ + ìŠ¤ë§ˆíŠ¸í°)
        showApprovalRequest: function(docName) {
            this.addLog(`
                <strong>ğŸ”” ìŠ¹ì¸ ìš”ì²­ ì „ë‹¬</strong><br>
                <strong>ìˆ˜ì‹ :</strong> í™ê¸¸ë™ë‹˜ (ì›¹ + ğŸ“± ìŠ¤ë§ˆíŠ¸í°)<br>
                <strong>ë‚´ìš©:</strong> ì œì£¼ì§€ë°©ë²•ì›ì—ì„œ ${docName}ì„(ë¥¼) ìš”ì²­í–ˆìŠµë‹ˆë‹¤
            `, 'approval');
            
            // ìŠ¤ë§ˆíŠ¸í° ì•±ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
            this.approvalChannel.postMessage({
                type: 'APPROVAL_REQUEST',
                from: 'ì œì£¼ì§€ë°©ë²•ì›',
                docName: docName,
                transactionId: this.transactionId,
                timestamp: new Date().toISOString()
            });
            
            console.log('ğŸ“± ìŠ¤ë§ˆíŠ¸í° ì•±ìœ¼ë¡œ ìŠ¹ì¸ ìš”ì²­ ì „ì†¡');
            
            const personalApproval = document.getElementById('personalApproval');
            personalApproval.innerHTML = `
                <div class="approval-request">
                    <h4>ğŸ”” ìŠ¹ì¸ ìš”ì²­</h4>
                    <p><strong>ìš”ì²­ ê¸°ê´€:</strong> ì œì£¼ì§€ë°©ë²•ì›</p>
                    <p><strong>ìš”ì²­ ì„œë¥˜:</strong> ${docName}</p>
                    <p><strong>ê±°ë˜ ID:</strong> #${this.transactionId}</p>
                    <p style="color: #059669; margin-top: 0.5rem;">ğŸ“± ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œë„ ì „ì†¡ë¨</p>
                    <div style="margin-top: 1rem;">
                        <button class="btn-approve" onclick="SimulationAI.approveRequest()">âœ… ìŠ¹ì¸ (ì›¹)</button>
                        <button class="btn-reject" onclick="SimulationAI.rejectRequest()">âŒ ê±°ë¶€ (ì›¹)</button>
                    </div>
                </div>
            `;
        },
        
        // 3ë‹¨ê³„: ìŠ¹ì¸ ì²˜ë¦¬
        approveRequest: function() {
            const docName = this.currentRequest.docName;
            
            this.addLog(`
                <strong>âœ… ë³¸ì¸ ìŠ¹ì¸ ì™„ë£Œ</strong><br>
                <strong>ìŠ¹ì¸ì:</strong> í™ê¸¸ë™<br>
                <strong>ì„œë¥˜:</strong> ${docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${this.transactionId}
            `, 'approval');
            
            document.getElementById('personalApproval').innerHTML = `
                <div style="background: #D1FAE5; padding: 1rem; border-radius: 4px; border: 2px solid #10B981;">
                    <strong style="color: #065F46;">âœ… ìŠ¹ì¸ ì™„ë£Œ</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 13px; color: #047857;">
                        ${docName} ì „ì†¡ ì¤‘...
                    </p>
                </div>
            `;
            
            // 4ë‹¨ê³„ë¡œ ì§„í–‰
            setTimeout(() => this.transferDocument(docName), 1500);
        },
        
        // ìŠ¤ë§ˆíŠ¸í° ìŠ¹ì¸ ì²˜ë¦¬
        handlePhoneApproval: function(data) {
            this.addLog(`
                <strong>ğŸ“± ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ìŠ¹ì¸</strong><br>
                <strong>ìŠ¹ì¸ì:</strong> í™ê¸¸ë™<br>
                <strong>ì„œë¥˜:</strong> ${data.docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${data.transactionId}
            `, 'approval');
            
            // approveRequestì™€ ë™ì¼í•œ ì²˜ë¦¬
            this.approveRequest();
        },
        
        // ìŠ¤ë§ˆíŠ¸í° ê±°ë¶€ ì²˜ë¦¬
        handlePhoneRejection: function(data) {
            this.addLog(`
                <strong>ğŸ“± ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ê±°ë¶€</strong><br>
                <strong>ê±°ë¶€ì:</strong> í™ê¸¸ë™<br>
                <strong>ì„œë¥˜:</strong> ${data.docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${data.transactionId}
            `, 'request');
            
            // rejectRequestì™€ ë™ì¼í•œ ì²˜ë¦¬
            this.rejectRequest();
        },
        
        // ê±°ë¶€ ì²˜ë¦¬
        rejectRequest: function() {
            const docName = this.currentRequest.docName;
            
            this.addLog(`
                <strong>âŒ ë³¸ì¸ ê±°ë¶€</strong><br>
                <strong>ê±°ë¶€ì:</strong> í™ê¸¸ë™<br>
                <strong>ì„œë¥˜:</strong> ${docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${this.transactionId}
            `, 'request');
            
            document.getElementById('personalApproval').innerHTML = `
                <div style="background: #FEE2E2; padding: 1rem; border-radius: 4px; border: 2px solid #DC2626;">
                    <strong style="color: #991B1B;">âŒ ìš”ì²­ ê±°ë¶€ë¨</strong>
                </div>
            `;
            
            this.currentRequest = null;
        },
        
        // 4ë‹¨ê³„: ë¬¸ì„œ ì „ì†¡ ë° ë¸”ë¡ì²´ì¸ ê¸°ë¡
        transferDocument: function(docName) {
            const hash = this.generateHash();
            
            this.addLog(`
                <strong>ğŸ“¤ ì„œë¥˜ ì „ì†¡ ì™„ë£Œ</strong><br>
                <strong>ë°œì‹ :</strong> ê°œì¸ AI (í™ê¸¸ë™)<br>
                <strong>ìˆ˜ì‹ :</strong> ë²•ì› AI<br>
                <strong>ì„œë¥˜:</strong> ${docName}<br>
                <strong>ê±°ë˜ ID:</strong> #${this.transactionId}
            `, 'transfer');
            
            this.addLog(`
                <strong>ğŸ”— OpenHash ë¸”ë¡ì²´ì¸ ê¸°ë¡</strong><br>
                <strong>ê±°ë˜ ID:</strong> #${this.transactionId}<br>
                <strong>í•´ì‹œ:</strong> 
                <div class="blockchain-hash">${hash}</div>
                <strong>íƒ€ì„ìŠ¤íƒ¬í”„:</strong> ${this.currentRequest.timestamp}<br>
                <strong>ì—ë„ˆì§€ ì ˆê°:</strong> 98.5% (vs ê¸°ì¡´ ë¸”ë¡ì²´ì¸)
            `, 'blockchain');
            
            // ë²•ì› íŒ¨ë„ì— ìˆ˜ì‹  í‘œì‹œ
            document.getElementById('courtReceived').innerHTML = `
                <div style="background: #DBEAFE; padding: 1rem; border-radius: 4px; border: 2px solid #0B4DA2;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1E3A8A; font-size: 14px;">âœ… ì„œë¥˜ ìˆ˜ì‹  ì™„ë£Œ</h4>
                    <p style="margin: 0.25rem 0; font-size: 13px; color: #1E40AF;"><strong>ì„œë¥˜ëª…:</strong> ${docName}</p>
                    <p style="margin: 0.25rem 0; font-size: 13px; color: #1E40AF;"><strong>ë°œì‹ :</strong> í™ê¸¸ë™</p>
                    <p style="margin: 0.25rem 0; font-size: 13px; color: #1E40AF;"><strong>ê±°ë˜ ID:</strong> #${this.transactionId}</p>
                    <div class="blockchain-hash">${hash}</div>
                </div>
            `;
            
            document.getElementById('personalApproval').innerHTML = '';
            this.currentRequest = null;
        }
    };
    
    console.log('âœ… AI-to-AI ì‹œë®¬ë ˆì´ì…˜ ë¡œë“œ ì™„ë£Œ');
})();
</script>

<!-- QR Code ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
// QR ì½”ë“œ ìƒì„±
window.addEventListener('load', function() {
    const qrcodeContainer = document.getElementById('qrcode');
    if (qrcodeContainer && typeof QRCode !== 'undefined') {
        new QRCode(qrcodeContainer, {
            text: 'http://100.30.14.224/jeju-integrated/chat/',
            width: 150,
            height: 150,
            colorDark: '#0B4DA2',
            colorLight: '#FFFFFF',
            correctLevel: QRCode.CorrectLevel.H
        });
        console.log('âœ… QR ì½”ë“œ ìƒì„± ì™„ë£Œ');
    }
});
</script>
