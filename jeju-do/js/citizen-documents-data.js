// ì‹œë¯¼ ì„œë¥˜ ë°ì´í„° - ì•ˆì „í•œ ë¡œë”
let citizenDocuments = {};

// DataLoader ì¤€ë¹„ ëŒ€ê¸° í•¨ìˆ˜
function waitForDataLoader(callback, maxRetries = 50, interval = 100) {
    let retries = 0;
    
    const check = () => {
        if (window.dataLoader && typeof window.dataLoader.loadCitizenDocuments === 'function') {
            callback();
        } else {
            retries++;
            if (retries < maxRetries) {
                setTimeout(check, interval);
            } else {
                console.error('DataLoader ë¡œë“œ íƒ€ì„ì•„ì›ƒ - ì›ë³¸ ë°ì´í„° ì‚¬ìš©');
                // íƒ€ì„ì•„ì›ƒ ì‹œ ì›ë³¸ ë°ì´í„°ë¡œ í´ë°±
                loadOriginalData();
            }
        }
    };
    
    check();
}

// ì›ë³¸ ë°ì´í„° í´ë°±
function loadOriginalData() {
    citizenDocuments = {
        'ì£¼ë¯¼ë“±ë¡ë“±ë³¸': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ“„', required: ['ì´ë¦„', 'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸', 'ì£¼ì†Œ'], description: 'ì£¼ë¯¼ë“±ë¡ìƒ ê¸°ì¬ì‚¬í•­ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì£¼ë¯¼ë“±ë¡ì´ˆë³¸': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ“‹', required: ['ì´ë¦„', 'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸', 'ì£¼ì†Œë³€ë™ë‚´ì—­'], description: 'ì£¼ë¯¼ë“±ë¡ ë³€ë™ì‚¬í•­ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', required: ['ì´ë¦„', 'ê°€ì¡±ê´€ê³„'], description: 'ê°€ì¡±ê´€ê³„ë¥¼ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'í˜¼ì¸ê´€ê³„ì¦ëª…ì„œ': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ’‘', required: ['ì´ë¦„', 'ë°°ìš°ìì •ë³´'], description: 'í˜¼ì¸ì‚¬ì‹¤ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì¶œìƒì¦ëª…ì„œ': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ‘¶', required: ['ì´ë¦„', 'ì¶œìƒì¼', 'ë¶€ëª¨ì •ë³´'], description: 'ì¶œìƒì‚¬ì‹¤ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì¸ê°ì¦ëª…ì„œ': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ”', required: ['ì´ë¦„', 'ì¸ê°ë‚ ì¸'], description: 'ë³¸ì¸ì˜ ì¸ê°ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ìš´ì „ë©´í—ˆì¦': { category: 'ìê²©/ë©´í—ˆ', icon: 'ğŸš—', required: ['ì´ë¦„', 'ë©´í—ˆë²ˆí˜¸', 'ë©´í—ˆì¢…ë¥˜'], description: 'ìš´ì „ë©´í—ˆ ë³´ìœ ë¥¼ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì—¬ê¶Œ': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸ›‚', required: ['ì´ë¦„', 'ì—¬ê¶Œë²ˆí˜¸', 'ìœ íš¨ê¸°ê°„'], description: 'êµ­ì œì—¬í–‰ ì‹ ë¶„ì¦ëª… ë¬¸ì„œ' },
        'ì™¸êµ­ì¸ë“±ë¡ì¦': { category: 'ì‹ ë¶„/ê±°ì£¼', icon: 'ğŸŒ', required: ['ì´ë¦„', 'êµ­ì ', 'ë“±ë¡ë²ˆí˜¸'], description: 'ì™¸êµ­ì¸ ì²´ë¥˜ ìê²© ì¦ëª… ë¬¸ì„œ' },
        'êµ­ë¯¼ê±´ê°•ë³´í—˜ì¦': { category: 'ë³´í—˜/ì—°ê¸ˆ', icon: 'ğŸ¥', required: ['ì´ë¦„', 'ê°€ì…ìë²ˆí˜¸'], description: 'ê±´ê°•ë³´í—˜ ê°€ì…ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê±´ê°•ë³´í—˜ìê²©í™•ì¸ì„œ': { category: 'ë³´í—˜/ì—°ê¸ˆ', icon: 'ğŸ“‹', required: ['ì´ë¦„', 'ìê²©ë‚´ì—­'], description: 'ê±´ê°•ë³´í—˜ ìê²©ì„ í™•ì¸í•˜ëŠ” ë¬¸ì„œ' },
        'ì†Œë“ê¸ˆì•¡ì¦ëª…ì›': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ’°', required: ['ì´ë¦„', 'ì†Œë“ê¸ˆì•¡', 'ê³¼ì„¸ê¸°ê°„'], description: 'ì†Œë“ê¸ˆì•¡ì„ ì¦ëª…í•˜ëŠ” ì„¸ë¬´ ë¬¸ì„œ' },
        'ì‚¬ì—…ìë“±ë¡ì¦': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ¢', required: ['ìƒí˜¸', 'ì‚¬ì—…ìë²ˆí˜¸', 'ëŒ€í‘œì'], description: 'ì‚¬ì—…ì ë“±ë¡ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ë¶€ë™ì‚°ë“±ê¸°ë¶€ë“±ë³¸': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ ', required: ['ì†Œì¬ì§€', 'ì†Œìœ ì', 'ê¶Œë¦¬ê´€ê³„'], description: 'ë¶€ë™ì‚° ê¶Œë¦¬ê´€ê³„ë¥¼ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'í† ì§€ëŒ€ì¥': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ“', required: ['ì§€ë²ˆ', 'ë©´ì ', 'ì†Œìœ ì'], description: 'í† ì§€ì˜ í˜„í™©ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê±´ì¶•ë¬¼ëŒ€ì¥': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ—ï¸', required: ['ì†Œì¬ì§€', 'êµ¬ì¡°', 'ë©´ì '], description: 'ê±´ì¶•ë¬¼ í˜„í™©ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ë‚©ì„¸ì¦ëª…ì„œ': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ§¾', required: ['ì´ë¦„', 'ë‚©ì„¸ë‚´ì—­'], description: 'ì„¸ê¸ˆ ë‚©ë¶€ì‚¬ì‹¤ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì§€ë°©ì„¸ë‚©ì„¸ì¦ëª…ì„œ': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ“', required: ['ì´ë¦„', 'ì§€ë°©ì„¸ë‚©ë¶€ë‚´ì—­'], description: 'ì§€ë°©ì„¸ ë‚©ë¶€ë¥¼ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì¬ì§ì¦ëª…ì„œ': { category: 'ê³ ìš©/í•™ë ¥', icon: 'ğŸ’¼', required: ['ì´ë¦„', 'ì¬ì§ê¸°ê°„', 'ì§ìœ„'], description: 'ì¬ì§ì‚¬ì‹¤ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê²½ë ¥ì¦ëª…ì„œ': { category: 'ê³ ìš©/í•™ë ¥', icon: 'ğŸ“Š', required: ['ì´ë¦„', 'ê²½ë ¥ë‚´ì—­'], description: 'ê²½ë ¥ì‚¬í•­ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì¡¸ì—…ì¦ëª…ì„œ': { category: 'ê³ ìš©/í•™ë ¥', icon: 'ğŸ“', required: ['ì´ë¦„', 'í•™êµëª…', 'ì¡¸ì—…ì¼'], description: 'ì¡¸ì—…ì‚¬ì‹¤ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì„±ì ì¦ëª…ì„œ': { category: 'ê³ ìš©/í•™ë ¥', icon: 'ğŸ“š', required: ['ì´ë¦„', 'í•™êµëª…', 'ì„±ì '], description: 'í•™ì—…ì„±ì ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ë³‘ì ì¦ëª…ì„œ': { category: 'ë³‘ì—­', icon: 'ğŸ–ï¸', required: ['ì´ë¦„', 'êµ°ë³„', 'ë³µë¬´ê¸°ê°„'], description: 'ë³‘ì—­ì‚¬í•­ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì¥ì• ì¸ì¦ëª…ì„œ': { category: 'ë³µì§€', icon: 'â™¿', required: ['ì´ë¦„', 'ì¥ì• ë“±ê¸‰', 'ì¥ì• ìœ í˜•'], description: 'ì¥ì• ì¸ ë“±ë¡ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ìì¦ëª…ì„œ': { category: 'ë³µì§€', icon: 'ğŸ¤', required: ['ì´ë¦„', 'ìˆ˜ê¸‰ìœ í˜•'], description: 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ ìê²©ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì°¨ëŸ‰ë“±ë¡ì¦': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸš™', required: ['ì°¨ëŸ‰ë²ˆí˜¸', 'ì†Œìœ ì', 'ì°¨ì¢…'], description: 'ìë™ì°¨ ë“±ë¡ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'í†µì¥ì‚¬ë³¸': { category: 'ê¸ˆìœµ', icon: 'ğŸ¦', required: ['ì˜ˆê¸ˆì£¼', 'ê³„ì¢Œë²ˆí˜¸', 'ì€í–‰ëª…'], description: 'ê¸ˆìœµê³„ì¢Œ ì •ë³´ ë¬¸ì„œ' },
        'ì”ì•¡ì¦ëª…ì„œ': { category: 'ê¸ˆìœµ', icon: 'ğŸ’µ', required: ['ì˜ˆê¸ˆì£¼', 'ê³„ì¢Œë²ˆí˜¸', 'ì”ì•¡'], description: 'ê³„ì¢Œ ì”ì•¡ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ê±°ë˜ë‚´ì—­ì„œ': { category: 'ê¸ˆìœµ', icon: 'ğŸ“Š', required: ['ì˜ˆê¸ˆì£¼', 'ê±°ë˜ë‚´ì—­'], description: 'ê³„ì¢Œ ê±°ë˜ë‚´ì—­ ë¬¸ì„œ' },
        'ì‹ ìš©ì •ë³´ì¡°íšŒì„œ': { category: 'ê¸ˆìœµ', icon: 'ğŸ“ˆ', required: ['ì´ë¦„', 'ì‹ ìš©ë“±ê¸‰'], description: 'ì‹ ìš©ì •ë³´ë¥¼ ì¡°íšŒí•œ ë¬¸ì„œ' },
        'ê·¼ë¡œì†Œë“ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ’¼', required: ['ì´ë¦„', 'ì†Œë“ê¸ˆì•¡', 'ì§•ìˆ˜ì„¸ì•¡'], description: 'ê·¼ë¡œì†Œë“ ì›ì²œì§•ìˆ˜ ë‚´ì—­ ë¬¸ì„œ' },
        'ì‚¬ì—…ì†Œë“ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ¢', required: ['ì´ë¦„', 'ì†Œë“ê¸ˆì•¡', 'ì§•ìˆ˜ì„¸ì•¡'], description: 'ì‚¬ì—…ì†Œë“ ì›ì²œì§•ìˆ˜ ë‚´ì—­ ë¬¸ì„œ' },
        'ë¶€ê°€ê°€ì¹˜ì„¸ê³¼ì„¸í‘œì¤€ì¦ëª…ì›': { category: 'ì„¸ê¸ˆ/ì†Œë“', icon: 'ğŸ“‹', required: ['ì‚¬ì—…ìë²ˆí˜¸', 'ê³¼ì„¸í‘œì¤€'], description: 'ë¶€ê°€ê°€ì¹˜ì„¸ ê³¼ì„¸í‘œì¤€ ì¦ëª… ë¬¸ì„œ' },
        'í‘œì¤€ì§€ê³µì‹œì§€ê°€í™•ì¸ì„œ': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ“', required: ['ì§€ë²ˆ', 'ê³µì‹œì§€ê°€'], description: 'í† ì§€ì˜ ê³µì‹œì§€ê°€ë¥¼ í™•ì¸í•˜ëŠ” ë¬¸ì„œ' },
        'ê°œë³„ê³µì‹œì§€ê°€í™•ì¸ì„œ': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ—ºï¸', required: ['ì§€ë²ˆ', 'ê°œë³„ê³µì‹œì§€ê°€'], description: 'ê°œë³„í† ì§€ì˜ ê³µì‹œì§€ê°€ ë¬¸ì„œ' },
        'êµ­ë¯¼ì—°ê¸ˆê°€ì…ì¦ëª…ì„œ': { category: 'ë³´í—˜/ì—°ê¸ˆ', icon: 'ğŸ‘´', required: ['ì´ë¦„', 'ê°€ì…ë‚´ì—­'], description: 'êµ­ë¯¼ì—°ê¸ˆ ê°€ì…ì„ ì¦ëª…í•˜ëŠ” ë¬¸ì„œ' },
        'ì§€ì ë„': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ—ºï¸', required: ['ì§€ë²ˆ', 'ê²½ê³„', 'ë©´ì '], description: 'í† ì§€ì˜ ìœ„ì¹˜ì™€ ê²½ê³„ë¥¼ í‘œì‹œí•œ ë„ë©´' },
        'ê±´ì¶•ë¬¼í˜„í™©ë„': { category: 'ì‚¬ì—…/ì¬ì‚°', icon: 'ğŸ—ï¸', required: ['ê±´ë¬¼ìœ„ì¹˜', 'êµ¬ì¡°'], description: 'ê±´ì¶•ë¬¼ì˜ ìœ„ì¹˜ì™€ êµ¬ì¡°ë¥¼ í‘œì‹œí•œ ë„ë©´' },
        'í™˜ê²½ì„±ì§ˆí™˜í™•ì¸ì„œ': { category: 'ë³µì§€', icon: 'ğŸŒ¿', required: ['ì´ë¦„', 'ì§„ë‹¨ë‚´ìš©'], description: 'í™˜ê²½ì„± ì§ˆí™˜ì„ í™•ì¸í•˜ëŠ” ì˜ë£Œ ë¬¸ì„œ' },
        'ì£¼íƒì„ëŒ€ì°¨ê³„ì•½ì„œ': { category: 'ê³„ì•½', icon: 'ğŸ ', required: ['ì„ëŒ€ì¸', 'ì„ì°¨ì¸', 'ê³„ì•½ë‚´ìš©'], description: 'ì£¼íƒ ì„ëŒ€ì°¨ ê³„ì•½ ë¬¸ì„œ' },
        'ìƒê°€ì„ëŒ€ì°¨ê³„ì•½ì„œ': { category: 'ê³„ì•½', icon: 'ğŸª', required: ['ì„ëŒ€ì¸', 'ì„ì°¨ì¸', 'ê³„ì•½ë‚´ìš©'], description: 'ìƒê°€ ì„ëŒ€ì°¨ ê³„ì•½ ë¬¸ì„œ' }
    };
    console.log('âœ… ì›ë³¸ ë°ì´í„° í´ë°± ë¡œë“œ ì™„ë£Œ:', Object.keys(citizenDocuments).length, 'ê°œ');
}

// DOMContentLoaded í›„ ì‹¤í–‰
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        waitForDataLoader(async () => {
            try {
                citizenDocuments = await window.dataLoader.loadCitizenDocuments();
                console.log('âœ… citizenDocuments ë¡œë“œ ì™„ë£Œ (DataLoader):', Object.keys(citizenDocuments).length, 'ê°œ');
            } catch (error) {
                console.error('citizenDocuments ë¡œë“œ ì‹¤íŒ¨, í´ë°±:', error);
                loadOriginalData();
            }
        });
    });
} else {
    // ì´ë¯¸ ë¡œë“œëœ ê²½ìš°
    waitForDataLoader(async () => {
        try {
            citizenDocuments = await window.dataLoader.loadCitizenDocuments();
            console.log('âœ… citizenDocuments ë¡œë“œ ì™„ë£Œ (DataLoader):', Object.keys(citizenDocuments).length, 'ê°œ');
        } catch (error) {
            console.error('citizenDocuments ë¡œë“œ ì‹¤íŒ¨, í´ë°±:', error);
            loadOriginalData();
        }
    });
}
