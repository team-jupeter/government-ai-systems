<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page - EGCT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .profile-section { display: grid; grid-template-columns: 320px 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg); }
        .profile-card { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); overflow: hidden; }
        .profile-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: var(--space-xl); text-align: center; color: var(--white); }
        .profile-avatar { width: 80px; height: 80px; background: var(--white); border-radius: 50%; margin: 0 auto var(--space-md); display: flex; align-items: center; justify-content: center; font-size: 32px; color: var(--primary); }
        .profile-name { font-size: var(--font-xl); font-weight: 700; margin-bottom: var(--space-xs); }
        .profile-id { font-size: var(--font-sm); opacity: 0.85; }
        .profile-badge { display: inline-block; background: #ffc107; color: #000; padding: 4px 14px; border-radius: 20px; font-size: var(--font-sm); font-weight: 600; margin-top: var(--space-md); }
        .profile-body { padding: var(--space-lg); }
        .profile-row { display: flex; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); font-size: var(--font-base); }
        .profile-row:last-child { border-bottom: none; }
        .profile-row .label { color: var(--gray-500); }
        .profile-row .value { font-weight: 600; color: var(--gray-900); }
        .asset-summary { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); padding: var(--space-xl); }
        .asset-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); }
        .asset-header h2 { font-size: var(--font-lg); color: var(--primary); }
        .asset-total { display: flex; align-items: baseline; gap: var(--space-md); margin-bottom: var(--space-xl); padding-bottom: var(--space-lg); border-bottom: 1px solid var(--gray-200); }
        .asset-total .amount { font-size: var(--font-xxl); font-weight: 700; color: var(--primary); }
        .asset-total .change { font-size: var(--font-base); padding: 6px 12px; border-radius: var(--radius-sm); }
        .asset-total .change.up { background: #e8f5e9; color: var(--success); }
        .asset-breakdown { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); }
        .asset-item { text-align: center; padding: var(--space-lg); background: var(--gray-100); border-radius: var(--radius-md); }
        .asset-item .icon { font-size: 28px; color: var(--primary); margin-bottom: var(--space-sm); }
        .asset-item .label { font-size: var(--font-sm); color: var(--gray-500); margin-bottom: var(--space-xs); }
        .asset-item .value { font-size: var(--font-lg); font-weight: 700; color: var(--gray-900); }
        .asset-item .sub { font-size: var(--font-sm); color: var(--gray-500); margin-top: var(--space-xs); }
        .section-card { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); margin-bottom: var(--space-lg); }
        .section-card .header { padding: var(--space-md) var(--space-lg); border-bottom: 1px solid var(--gray-200); }
        .section-card .header h3 { font-size: var(--font-md); color: var(--primary); display: flex; align-items: center; gap: var(--space-sm); }
        .section-card .body { padding: var(--space-lg); }
        .portfolio-content { display: grid; grid-template-columns: 200px 1fr; gap: var(--space-lg); align-items: center; }
        .legend-item { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); }
        .legend-item:last-child { border-bottom: none; }
        .legend-left { display: flex; align-items: center; gap: var(--space-sm); }
        .legend-dot { width: 14px; height: 14px; border-radius: 4px; }
        .legend-name { font-size: var(--font-base); font-weight: 500; }
        .legend-right { text-align: right; }
        .legend-value { font-size: var(--font-base); font-weight: 600; }
        .legend-pct { font-size: var(--font-sm); color: var(--gray-500); }
        .quick-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-md); }
        .quick-item { text-align: center; padding: var(--space-lg); background: var(--gray-100); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .quick-item:hover { background: #e3f2fd; }
        .quick-item i { font-size: 28px; color: var(--primary); margin-bottom: var(--space-sm); display: block; }
        .quick-item .label { font-size: var(--font-base); color: var(--gray-700); }
        .alert-item { display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); background: var(--gray-100); border-radius: var(--radius-md); margin-bottom: var(--space-sm); border-left: 3px solid var(--accent); }
        .alert-item i { font-size: 20px; color: var(--accent); }
        .alert-item .content { flex: 1; }
        .alert-item .title { font-size: var(--font-base); font-weight: 600; }
        .alert-item .desc { font-size: var(--font-sm); color: var(--gray-500); margin-top: 2px; }
        .alert-item .time { font-size: var(--font-sm); color: var(--gray-400); }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); }
        .setting-row:last-child { border-bottom: none; }
        .setting-info .title { font-size: var(--font-base); font-weight: 500; }
        .setting-info .desc { font-size: var(--font-sm); color: var(--gray-500); margin-top: 2px; }
        .toggle { width: 48px; height: 26px; background: var(--gray-300); border-radius: 13px; position: relative; cursor: pointer; transition: background 0.2s; }
        .toggle.on { background: var(--primary); }
        .toggle::after { content: ''; position: absolute; width: 22px; height: 22px; background: var(--white); border-radius: 50%; top: 2px; left: 2px; transition: left 0.2s; box-shadow: var(--shadow-sm); }
        .toggle.on::after { left: 24px; }
        .no-login { text-align: center; padding: 60px 20px; }
        .no-login i { font-size: 48px; color: #ccc; margin-bottom: 16px; }
        .no-login p { color: #666; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="top-header">
        <div class="top-header-inner">
            <h1><span class="icon">ğŸª™</span> EGCT í† í° ê±°ë˜ì†Œ</h1>
        </div>
    </div>
    <div class="tab-nav">
        <div class="tab-nav-inner">
            <a href="trading.html" class="tab"><i class="fas fa-exchange-alt"></i>EGCT ê±°ë˜</a>
            <a href="hashchain-demo.html" class="tab"><i class="fas fa-link"></i>ì˜¤í”ˆí•´ì‹œ</a>
            <a href="pool.html" class="tab"><i class="fas fa-cubes"></i>ìì‚° POOL</a>
            <a href="exchange.html" class="tab"><i class="fas fa-chart-line"></i>ìì‚° ê±°ë˜ì†Œ</a>
            <a href="holders.html" class="tab"><i class="fas fa-users"></i>EGCT ë³´ìœ  í˜„í™©</a>
            <a href="prices.html" class="tab"><i class="fas fa-chart-line"></i>ê°€ê²© ë™í–¥</a>
            <a href="mypage.html" class="tab active"><i class="fas fa-user-circle"></i>My Page</a>
            <a href="pdv.html" class="tab"><i class="fas fa-shield-halved"></i>My PDV</a>
        </div>
    </div>
    
    <div class="container" id="mainContent">
        <div class="profile-section">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar"><i class="fas fa-user"></i></div>
                    <div class="profile-name" id="userName">-</div>
                    <div class="profile-id" id="userInfo">ë¡œê·¸ì¸ í•„ìš”</div>
                    <div class="profile-badge"><i class="fas fa-crown"></i> VIP íšŒì›</div>
                </div>
                <div class="profile-body">
                    <div class="profile-row"><span class="label">íšŒì› ë“±ê¸‰</span><span class="value text-primary">VIP</span></div>
                    <div class="profile-row"><span class="label">ê°€ì…ì¼</span><span class="value">2024.06.15</span></div>
                    <div class="profile-row"><span class="label">ìµœê·¼ ì ‘ì†</span><span class="value" id="lastAccess">-</span></div>
                    <div class="profile-row"><span class="label">ë³´ì•ˆ ë“±ê¸‰</span><span class="value text-success"><i class="fas fa-shield-alt"></i> ë†’ìŒ</span></div>
                    <div class="profile-row"><span class="label">ì´ ê±°ë˜ ê±´ìˆ˜</span><span class="value" id="txCount">0ê±´</span></div>
                    <div class="profile-row"><span class="label">ê±°ë˜ ìˆ˜ìˆ˜ë£Œ</span><span class="value">0.05% (VIP í• ì¸)</span></div>
                </div>
            </div>
            
            <div class="asset-summary">
                <div class="asset-header">
                    <h2><i class="fas fa-wallet"></i> ìì‚° í˜„í™©</h2>
                    <span class="text-muted text-sm" id="assetTime">-</span>
                </div>
                <div class="asset-total">
                    <span class="amount" id="totalAsset">â‚©0</span>
                    <span class="change up" id="assetChange"><i class="fas fa-arrow-up"></i> -</span>
                </div>
                <div class="asset-breakdown">
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-coins"></i></div>
                        <div class="label">ë³´ìœ  EGCT</div>
                        <div class="value" id="egctBalance">0 T</div>
                        <div class="sub" id="egctValue">â‚©0</div>
                    </div>
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-won-sign"></i></div>
                        <div class="label">ë³´ìœ  í˜„ê¸ˆ</div>
                        <div class="value" id="krwBalance">â‚©0</div>
                        <div class="sub">ì¶œê¸ˆ ê°€ëŠ¥</div>
                    </div>
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-chart-pie"></i></div>
                        <div class="label">ì´ ê±°ë˜ì•¡</div>
                        <div class="value" id="totalTraded">â‚©0</div>
                        <div class="sub" id="tradedCount">0ê±´</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grid-2 mb-lg">
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-chart-pie"></i> í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±</h3></div>
                <div class="body">
                    <div class="portfolio-content">
                        <div class="chart-container sm"><canvas id="portfolioChart"></canvas></div>
                        <div class="portfolio-legend" id="portfolioLegend"></div>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-history"></i> ìµœê·¼ ê±°ë˜ ë‚´ì—­</h3></div>
                <div class="body">
                    <table class="data-table">
                        <thead><tr><th>ì¼ì‹œ</th><th>êµ¬ë¶„</th><th>ìˆ˜ëŸ‰</th><th>ë‹¨ê°€</th><th>ê¸ˆì•¡</th></tr></thead>
                        <tbody id="recentTxBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="grid-3">
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-th-large"></i> ë¹ ë¥¸ ë©”ë‰´</h3></div>
                <div class="body">
                    <div class="quick-menu">
                        <a href="trading.html" class="quick-item"><i class="fas fa-exchange-alt"></i><div class="label">ê±°ë˜í•˜ê¸°</div></a>
                        <a href="pdv.html" class="quick-item"><i class="fas fa-shield-halved"></i><div class="label">My PDV</div></a>
                        <a href="holders.html" class="quick-item"><i class="fas fa-users"></i><div class="label">ë³´ìœ í˜„í™©</div></a>
                        <a href="prices.html" class="quick-item"><i class="fas fa-chart-line"></i><div class="label">ê°€ê²©ë™í–¥</div></a>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-bell"></i> ìµœê·¼ ì•Œë¦¼</h3></div>
                <div class="body" id="alertList"></div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-cog"></i> ì„¤ì •</h3></div>
                <div class="body">
                    <div class="setting-row"><div class="setting-info"><div class="title">ê°€ê²© ì•Œë¦¼</div><div class="desc">ëª©í‘œê°€ ë„ë‹¬ ì‹œ ì•Œë¦¼</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                    <div class="setting-row"><div class="setting-info"><div class="title">ì²´ê²° ì•Œë¦¼</div><div class="desc">ì£¼ë¬¸ ì²´ê²° ì‹œ ì•Œë¦¼</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                    <div class="setting-row"><div class="setting-info"><div class="title">2ë‹¨ê³„ ì¸ì¦</div><div class="desc">ë¡œê·¸ì¸ ì‹œ OTP ì¸ì¦</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    var EGCT_PRICE = 1005;
    
    // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
    var user = JSON.parse(localStorage.getItem('egct_user') || 'null');
    var egctBalance = parseInt(localStorage.getItem('egct_balance')) || 0;
    var krwBalance = parseInt(localStorage.getItem('egct_krw')) || 0;
    var transactions = JSON.parse(localStorage.getItem('egct_pdv_transactions') || '[]');
    
    // í”„ë¡œí•„ ì—…ë°ì´íŠ¸
    if (user) {
        document.getElementById('userName').textContent = user.displayName || user.name || user.id;
        document.getElementById('userInfo').textContent = user.id + ' Â· ' + (user.email || 'user@egct.io');
    }
    
    document.getElementById('lastAccess').textContent = new Date().toLocaleString('ko-KR');
    document.getElementById('txCount').textContent = transactions.length + 'ê±´';
    
    // ìì‚° í˜„í™©
    var egctValue = egctBalance * EGCT_PRICE;
    var totalAsset = egctValue + krwBalance;
    
    document.getElementById('assetTime').textContent = new Date().toLocaleString('ko-KR') + ' ê¸°ì¤€';
    document.getElementById('totalAsset').textContent = 'â‚©' + totalAsset.toLocaleString();
    document.getElementById('egctBalance').textContent = egctBalance.toLocaleString() + ' T';
    document.getElementById('egctValue').textContent = 'â‚©' + egctValue.toLocaleString();
    document.getElementById('krwBalance').textContent = 'â‚©' + krwBalance.toLocaleString();
    
    // ì´ ê±°ë˜ì•¡ ê³„ì‚°
    var totalTraded = 0;
    for (var i = 0; i < transactions.length; i++) {
        totalTraded += transactions[i].value || (transactions[i].amount * transactions[i].price);
    }
    document.getElementById('totalTraded').textContent = 'â‚©' + totalTraded.toLocaleString();
    document.getElementById('tradedCount').textContent = transactions.length + 'ê±´';
    
    // í¬íŠ¸í´ë¦¬ì˜¤ ë¹„ìœ¨
    var egctPct = totalAsset > 0 ? ((egctValue / totalAsset) * 100).toFixed(1) : 0;
    var krwPct = totalAsset > 0 ? ((krwBalance / totalAsset) * 100).toFixed(1) : 0;
    
    document.getElementById('portfolioLegend').innerHTML = 
        '<div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#003566;"></div><span class="legend-name">EGCT</span></div><div class="legend-right"><div class="legend-value">' + egctBalance.toLocaleString() + ' T</div><div class="legend-pct">' + egctPct + '%</div></div></div>' +
        '<div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#0077cc;"></div><span class="legend-name">KRW</span></div><div class="legend-right"><div class="legend-value">â‚©' + krwBalance.toLocaleString() + '</div><div class="legend-pct">' + krwPct + '%</div></div></div>';
    
    // ìµœê·¼ ê±°ë˜ ë‚´ì—­
    var txHtml = '';
    var recentTx = transactions.slice(-5).reverse();
    if (recentTx.length === 0) {
        txHtml = '<tr><td colspan="5" style="text-align:center;color:#999;padding:20px;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
    } else {
        for (var i = 0; i < recentTx.length; i++) {
            var tx = recentTx[i];
            var badgeClass = tx.type === 'BUY' ? 'badge-success' : 'badge-danger';
            var typeLabel = tx.type === 'BUY' ? 'ë§¤ìˆ˜' : 'ë§¤ë„';
            var time = new Date(tx.timestamp).toLocaleString('ko-KR', {month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit'});
            var value = tx.value || (tx.amount * tx.price);
            txHtml += '<tr><td>' + time + '</td><td><span class="badge ' + badgeClass + '">' + typeLabel + '</span></td><td class="num">' + tx.amount.toLocaleString() + ' T</td><td class="num">â‚©' + tx.price.toLocaleString() + '</td><td class="num">â‚©' + value.toLocaleString() + '</td></tr>';
        }
    }
    document.getElementById('recentTxBody').innerHTML = txHtml;
    
    // ì•Œë¦¼
    var alertHtml = '';
    if (recentTx.length > 0) {
        for (var i = 0; i < Math.min(recentTx.length, 3); i++) {
            var tx = recentTx[i];
            var icon = tx.type === 'BUY' ? 'fa-arrow-down' : 'fa-arrow-up';
            var color = tx.type === 'BUY' ? '#2e7d32' : '#c62828';
            var label = tx.type === 'BUY' ? 'ë§¤ìˆ˜ ì²´ê²°' : 'ë§¤ë„ ë“±ë¡';
            var time = new Date(tx.timestamp).toLocaleTimeString('ko-KR', {hour:'2-digit',minute:'2-digit'});
            alertHtml += '<div class="alert-item"><i class="fas ' + icon + '" style="color:' + color + ';"></i><div class="content"><div class="title">' + label + '</div><div class="desc">' + tx.amount + ' T @ â‚©' + tx.price.toLocaleString() + '</div></div><div class="time">' + time + '</div></div>';
        }
    } else {
        alertHtml = '<div style="text-align:center;color:#999;padding:20px;">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    }
    document.getElementById('alertList').innerHTML = alertHtml;
    
    // í¬íŠ¸í´ë¦¬ì˜¤ ì°¨íŠ¸
    new Chart(document.getElementById('portfolioChart'), {
        type: 'doughnut',
        data: {
            labels: ['EGCT', 'KRW'],
            datasets: [{ data: [parseFloat(egctPct), parseFloat(krwPct)], backgroundColor: ['#003566', '#0077cc'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { display: false } } }
    });
})();
</script>
</body>
</html>
